<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>基于qt的网络视频监控系统（附程序） | JAS's Blog</title><meta name="keywords" content="linux,ARM,软件开发,OV5640,Socket,V4L2,C++,imx6ull,网络传输,QT,远程视频影像"><meta name="author" content="JAS-guanjieshi"><meta name="copyright" content="JAS-guanjieshi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文为基于qt的网络视频监控系统项目的个人笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="基于qt的网络视频监控系统（附程序）">
<meta property="og:url" content="http://192.168.0.9/posts/10008/index.html">
<meta property="og:site_name" content="JAS&#39;s Blog">
<meta property="og:description" content="本文为基于qt的网络视频监控系统项目的个人笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://192.168.0.9/img/qt7.png">
<meta property="article:published_time" content="2022-07-23T03:50:00.000Z">
<meta property="article:modified_time" content="2022-07-23T17:30:37.000Z">
<meta property="article:author" content="JAS-guanjieshi">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="ARM">
<meta property="article:tag" content="软件开发">
<meta property="article:tag" content="OV5640">
<meta property="article:tag" content="Socket">
<meta property="article:tag" content="V4L2">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="imx6ull">
<meta property="article:tag" content="网络传输">
<meta property="article:tag" content="QT">
<meta property="article:tag" content="远程视频影像">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://192.168.0.9/img/qt7.png"><link rel="shortcut icon" href="/img/Batman.png"><link rel="canonical" href="http://192.168.0.9/posts/10008/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '基于qt的网络视频监控系统（附程序）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-24 01:30:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E7%95%AA%E5%89%A7"><i class="fa-fw /bangumis/"></i><span> 0</span></a></li><li><a class="site-page child" href="/%E9%9F%B3%E4%B9%90"><i class="fa-fw /music/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/qt7.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">JAS's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E7%95%AA%E5%89%A7"><i class="fa-fw /bangumis/"></i><span> 0</span></a></li><li><a class="site-page child" href="/%E9%9F%B3%E4%B9%90"><i class="fa-fw /music/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">基于qt的网络视频监控系统（附程序）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-23T03:50:00.000Z" title="发表于 2022-07-23 11:50:00">2022-07-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-23T17:30:37.000Z" title="更新于 2022-07-24 01:30:37">2022-07-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/%E5%9F%BA%E4%BA%8Eqt%E7%9A%84%E7%BD%91%E7%BB%9C%E8%A7%86%E9%A2%91%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/">基于qt的网络视频监控系统</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="基于qt的网络视频监控系统（附程序）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="摘要"><a href="#摘要" class="headerlink" title=" 摘要"></a><center> 摘要</h1><p>在流媒体技术的发展中，视频技术的发展越来越迅速，大量应用于安防与教育事业，比如在远程视频教育、在线远程视频会议、医疗、各种场所的视频监控以及危险区域的探测等方面。Linux操作系统在发展的过程具备了很好的网络性能。Linux系统下提供了非常丰富的开源软件和视频支持，支持各种硬件平台，因此 Linux平台成为了视频采集的最佳平台。Linux系统上的软件开发具有高可靠性、低成本、高度自动化、高可配置性、及低耗费等一些优点，同时能够很好的完成多任务和实时性的设计需求。<br>我国资深嵌入式系统专家——沈绪榜院士曾预言:“未来十年将会产生针头大小，具有超过一亿次运算能力的嵌入式智能芯片”。这些将为我们的开发提供了相当大的创造空间。中国应当注意发展这一智力密集型产业”。<br>综上所述，嵌入式Linux操作系统在广泛和深入的应用于各个领域，应用的技术也越来越复杂。针对基于网络传输的视频监控系统的实际需求与应用，结合视频的图像采集技术与编码技术，嵌入式Linux操作系统和网络编程技术等多方面的新兴技术,设计的一套Linux 网络视频监控系统,用来进行视频数据的采集、视频数据的压缩编码与解码以及视频的网络传输，该系统基于Linux 操作系统进行开发的，从OV5640捕捉视频数据，QT实现客户端和服务器端，即可查看远程视频影像。<br><strong>关键词</strong>： <em>OV5640、网络传输、QT实现、远程视频影像</em></p>
<h1 id="一、目的及意义"><a href="#一、目的及意义" class="headerlink" title="一、目的及意义"></a>一、目的及意义</h1><p>视频监控系统的设计主要说明视频监控系统的详细设计与实现。介绍了系统中各个模块的设计与模块功能的实现以及应用的相关技术。我将会对每一个模块的设计以及实现方法给出简单的文字说明以及设计的流程图。<br>课程设计的主要目的是学习熟悉基于TCP/IP网络的远程视频监控系统的基本知识和相关的多媒体开发技术。随着5G通讯时代的到来，我们更可以将视频监控客户端发展到移动终端，这将使我们更加方便。<br>纵观视频监控的研究进展，从闭路电视系统构建的模拟系统、经历了数字信号控制的模拟视频监控系统、过渡到数字硬盘录像设备为核心的视频监控系统和当代的数字网络视频监控系统这几大重要阶段。<br>数字网络视频监控系统与其它监控系统的优点:<br><strong>a、布控区域广阔</strong><br>数字网络视频监控系统是可以超越地域的限制的,可以延伸整个需要布控区域，这是因为它将网络视频信号采集终端直接连入网络，并且能够解除信号的衰减和缆线长度的局限性，而且网络是不受距离长短的影响。<br><strong>b、系统具有几乎无限的无缝扩展能力</strong><br>需要增加设备时只要将IP地址进行扩充操作就行了,因为所有的IP地址都在系统中进行了标识。<br><strong>c、可组成非常复杂的监控网络</strong><br>监控系统是以基于网络视频信号采集终端为核心，在组网方式上与基于PC平台的监控和传统的模拟监控方式有了质的飞跃,视频信号采集终端输出已完成了从模拟到数字的转换并压缩，在网络上传输时采用统一的协议，能够实现跨路由器、跨网关等的远程视频传输。<br><strong>d、性能稳定可靠，无需专人管理</strong><br>视频监控系统中采集视频信号的终端应用了嵌入式Linux技术,主要采用嵌入式多任务实时操作系统,又能够将网络功能和视频压缩功能集中到一个极小体积的设备内，同时可以直接连入广域网络或者局域网络，即插即看，系统的稳定性、可靠性、实时性得到了极大的提升，能够运用于无人值守的环境中。<br><strong>e、我们可以从视频监控中心同时观看多个USB 网络摄像头视频，但是对网络带宽是有一定的要求。</strong></p>
<h1 id="二、视频监控系统的组成"><a href="#二、视频监控系统的组成" class="headerlink" title="二、视频监控系统的组成"></a>二、视频监控系统的组成</h1><h2 id="1、总体设计"><a href="#1、总体设计" class="headerlink" title="1、总体设计"></a>1、总体设计</h2><p>视频监控系统大致可分为三大模块:视频数据信号的采集部分、网络传输部分以及远程客户端视频的渲染部分。<br>总体框图如图所示：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt1.jpg" alt="总体框图"></p>
<h2 id="2、功能分析"><a href="#2、功能分析" class="headerlink" title="2、功能分析"></a>2、功能分析</h2><p>服务器(server）端负责视频数据的采集，采集可以通过v4l2编程实现，有详细的API开发文档，以及v4l2编程的相关资料可以参考。<br>客户端(client）主要负责的是将接收到的视频数据通过QT编程将其渲染出来。主要用到了QT中的信号(signal）和槽(slot）机制、以及绘图事件，QT是利用C++编程，而且它封装了一套自己的库可以实现跨平台，这也就解决了前面提到的客户端的跨平台特性。<br>还有连接Server 与Client的就是采用Socket网络服务器的搭建，这主要采用的是Linux环境网络编程。该网络的搭建主要是利用基于TCP/IP协议的HTTP协议，将服务器( server）端采集到的视频数据封装成http 数据帧的形式，然后利用TCP 协议将视频数据帧发送到客户端（client）。由于是实时传输，所以还用到多线程，使得每个客户端（client）相互独立，各个线程都将执行一个死循环，源源不断的给客户端发送视频数据。</p>
<h2 id="3、何采集视频数据逻辑概要"><a href="#3、何采集视频数据逻辑概要" class="headerlink" title="3、何采集视频数据逻辑概要"></a>3、何采集视频数据逻辑概要</h2><p>这一节主要介绍了服务器（server）端的如何采集视频数据。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt2.jpg" alt="如何采集视频数据"><br>UDP 或者 TCP 传输，使用 Qt 封装好 TCP/IP 协议 Socket 抽象层接口来通信。那么我们也可以 使用它们来发送图像数据啊。这样，服务器和客户端我们完全可以使用 Qt 来写了。实际上 RTSP 协议和 RTMP 协议都使用 TCP/IP 协议，在传输层使用了 UDP 或 TCP。<br>项目流程如下：<br>（1） 服务器采集摄像头的数据。<br>（2） 处理视频数据转交给 Socket，由 TCP/UDP 传输。<br>（3） 客户端接收视频数据。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt3.png" alt="采集视频数据并发送"></p>
<h1 id="三、视频监控系统的组成"><a href="#三、视频监控系统的组成" class="headerlink" title="三、视频监控系统的组成"></a>三、视频监控系统的组成</h1><h2 id="1-系统测试过程"><a href="#1-系统测试过程" class="headerlink" title="1.系统测试过程"></a>1.系统测试过程</h2><p>视频监控系统的测试将分别对服务端和客户端进行，我们可以下执行步骤。    1）连接好OV5640摄像头，在 Linux终端运行服务端程序，获取摄像头设备的数据，如果摄像头有不匹配或者连接问题，则会报错。<br>2）如上一步正常则运行客户端程序，也就是采用QT设计的图形化界面，其实在没有开启服务端程序时，也可以开启客户端，但是不能获取到视频数据。<br>3）在客户端输入服务端的IP地址（如本地摄像头IP为127.0.0.1），设置想要查看的窗口，按照自己的要求进行监控，通过服务端可以设计客户端相关信息在图形化界面上显示出来，以便用户查看。<br>4）通过客户端查看各个OV5640拍摄到的视频。<br>系统调试及运行的效果图下所示。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt4.png" alt="串口传输"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt5.png" alt="串口传输"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt6.png" alt="串口传输"><br>Ov5640连接正常，通过串口进行程序的烧录<br>客户端：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt7.png" alt="客户端测试"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt8.png" alt="客户端测试"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt9.png" alt="客户端测试"><br>服务端：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt10.jpg" alt="服务端测试"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt11.jpg" alt="服务端测试"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/qt12.jpg" alt="服务端测试"><br>测试完毕，客户端和服务端功能均正常</p>
<h1 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h1><p>视频监控系统课题的所设计和实现中，充分利用了Linux操作系统作为嵌入式操作系统的诸多优势，嵌入式Linux系统下的视频网络监控系统是计算机软硬件、电工电子装置以及网络通信等多方面的有机结合而形成的，它主要以网络化、交互性、智能化为特征，结构较为复杂。如果采用OSI七层模型的内容和形式，把相应的控制模块硬件、视频数据采集、视频数据的编码、视频数据的解码和视频监控软件以及开发环境的搭建等进行有机结合,可以形成一个统一完整的系统框架。在 Linux操作系统中调用v4l2编程中的API接口和底层设备驱动程序来完成视频捕获操作。v4L2是Linux操作系统中的内核驱动，主要是关于视频的开发。它为Linux操作系统中的各种视频设备提供了统一的API编程接口，应用程序可以通过这些接口函数进行操纵各种不同的设备。结合了QT技术构建了具有图形化界面支持的嵌入式系统开发平台，这种系统结构模式是目前在 PC上进行视频监控系统开发的热点。<br>对未来视频监控的展望:未来的视频监控系统应该更加趋向智能化、人性化、同时能够自行的对异常情况分析判断。另外在不久的未来，视频监控系统还可具有安防互动功能，与各种传感器，控制器链接，实现自动目标跟踪等功能。而且随着5G通信技术的发展和成熟，视频监控系统的成本也应该进一步降低，并且能够将其移植到移动终端，以适应更广泛领域的需要。<br>由于我还是个初学者，虽然最终能够实现了一些功能，但是对中间相关的一些模块开发，比如驱动、QTSocket原理等等还不是很熟悉，还有待进一步学习和掌握。</p>
<h1 id="附录：源程序代码"><a href="#附录：源程序代码" class="headerlink" title=" 附录：源程序代码"></a><center> 附录：源程序代码</h1><p>服务端：<br>video_server.pro：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">QT       += core gui network</span><br><span class="line"></span><br><span class="line">greaterThan(QT_MAJOR_VERSION, 4): QT += widgets</span><br><span class="line"></span><br><span class="line">CONFIG += c++11</span><br><span class="line"></span><br><span class="line"><span class="comment"># The following define makes your compiler emit warnings if you use</span></span><br><span class="line"><span class="comment"># any Qt feature that has been marked deprecated (the exact warnings</span></span><br><span class="line"><span class="comment"># depend on your compiler). Please consult the documentation of the</span></span><br><span class="line"><span class="comment"># deprecated API in order to know how to port your code away from it.</span></span><br><span class="line">DEFINES += QT_DEPRECATED_WARNINGS</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can also make your code fail to compile if it uses deprecated APIs.</span></span><br><span class="line"><span class="comment"># In order to do so, uncomment the following line.</span></span><br><span class="line"><span class="comment"># You can also select to disable deprecated APIs only up to a certain version of Qt.</span></span><br><span class="line"><span class="comment">#DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x060000    # disables all the APIs deprecated before Qt 6.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改生成的应用程序的名字</span></span><br><span class="line">TARGET = 视频监控服务端v0.1-by-JASand炳川</span><br><span class="line"><span class="comment">#指定生成的makefile的类型 lib</span></span><br><span class="line">TEMPLATE = app</span><br><span class="line"></span><br><span class="line">SOURCES += \</span><br><span class="line">    capture_thread.cpp \</span><br><span class="line">    main.cpp \</span><br><span class="line">    mainwindow.cpp</span><br><span class="line"></span><br><span class="line">HEADERS += \</span><br><span class="line">    capture_thread.h \</span><br><span class="line">    mainwindow.h</span><br><span class="line"></span><br><span class="line"><span class="comment"># Default rules for deployment.</span></span><br><span class="line">qnx: target.path = /tmp/$<span class="variable">$&#123;TARGET&#125;</span>/bin</span><br><span class="line"><span class="keyword">else</span>: unix:!android: target.path = /opt/$<span class="variable">$&#123;TARGET&#125;</span>/bin</span><br><span class="line">!isEmpty(target.path): INSTALLS += target</span><br></pre></td></tr></table></figure>
<p>Capture_thread.h:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CAPTURE_THREAD_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CAPTURE_THREAD_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> linux</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/videodev2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QThread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QByteArray&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QBuffer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QUdpSocket&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VIDEO_DEV			<span class="string">&quot;/dev/video1&quot;</span><span class="comment">//摄像头设备节点</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FB_DEV				<span class="string">&quot;/dev/fb0&quot;</span>  <span class="comment">//LCD设备节点</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VIDEO_BUFFER_COUNT	3<span class="comment">//帧缓冲数量</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">buffer_info</span> &#123;</span><br><span class="line">    <span class="type">void</span> *start;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> length;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CaptureThread</span> : <span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="comment">/* 准备图片 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">imageReady</span><span class="params">(QImage)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendImage</span><span class="params">(QImage)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/* 线程开启flag */</span></span><br><span class="line">    <span class="type">bool</span> startFlag = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 开启广播flag */</span></span><br><span class="line">    <span class="type">bool</span> startBroadcast = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 本地显示flag  */</span></span><br><span class="line">    <span class="type">bool</span> startLocalDisplay = <span class="literal">false</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CaptureThread</span>(QObject *parent = <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Q_UNUSED</span>(parent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="comment">/*在这个区内声明的槽意味着任何对象都可将信号与之相连接。这对于组件编程非常有用，</span></span><br><span class="line"><span class="comment">     * 你可以创建彼此互不了解的对象，将它们的信号与槽进行连接以便信息正确传递*/</span></span><br><span class="line">    <span class="comment">/* 设置线程 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setThreadStart</span><span class="params">(<span class="type">bool</span> start)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        startFlag = start;</span><br><span class="line">        <span class="keyword">if</span> (start) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;<span class="built_in">isRunning</span>())</span><br><span class="line">                <span class="keyword">this</span>-&gt;<span class="built_in">start</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;<span class="built_in">quit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 设置广播 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setBroadcast</span><span class="params">(<span class="type">bool</span> start)</span> </span>&#123;</span><br><span class="line">        startBroadcast = start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 设置本地显示 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setLocalDisplay</span><span class="params">(<span class="type">bool</span> start)</span> </span>&#123;</span><br><span class="line">        startLocalDisplay = start;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// CAPTURE_THREAD_H</span></span></span><br><span class="line"></span><br><span class="line">capture_thread.cpp:</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;capture_thread.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CaptureThread::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* 下面的代码参考了正点原子C应用编程V4L2章节的摄像头编程*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> linux</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __arm__</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="type">int</span> video_fd = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">v4l2_format</span> fmt;<span class="comment">//https://blog.csdn.net/xxxxxlllllxl/article/details/22074151</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">v4l2_requestbuffers</span> req_bufs;</span><br><span class="line">    <span class="type">static</span> <span class="keyword">struct</span> <span class="title class_">v4l2_buffer</span> buf;</span><br><span class="line">    <span class="type">int</span> n_buf;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">buffer_info</span> bufs_info[VIDEO_BUFFER_COUNT];</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">v4l2_buf_type</span> type;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//文件描述符：本质是一个正整数 open函数 0-OPEN-MAX</span></span><br><span class="line">    video_fd = <span class="built_in">open</span>(VIDEO_DEV, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> &gt; video_fd)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ERROR: failed to open video device %s\n&quot;</span>, VIDEO_DEV);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 设置帧格式 */</span></span><br><span class="line">    fmt.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;<span class="comment">//type类型</span></span><br><span class="line">    fmt.fmt.pix.width = <span class="number">640</span>;<span class="comment">//视频帧宽度</span></span><br><span class="line">    fmt.fmt.pix.height = <span class="number">480</span>;<span class="comment">//视频帧高度</span></span><br><span class="line">    fmt.fmt.pix.colorspace = V4L2_COLORSPACE_SRGB;</span><br><span class="line">    fmt.fmt.pix.pixelformat = V4L2_PIX_FMT_RGB565;<span class="comment">//像素格式</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> &gt; <span class="built_in">ioctl</span>(video_fd, VIDIOC_S_FMT, &amp;fmt))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ERROR: failed to VIDIOC_S_FMT\n&quot;</span>);</span><br><span class="line">        <span class="built_in">close</span>(video_fd);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 申请帧缓冲 */</span></span><br><span class="line">    req_bufs.count = VIDEO_BUFFER_COUNT;<span class="comment">//帧缓冲的数量</span></span><br><span class="line">    req_bufs.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;</span><br><span class="line">    req_bufs.memory = V4L2_MEMORY_MMAP;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> &gt; <span class="built_in">ioctl</span>(video_fd, VIDIOC_REQBUFS, &amp;req_bufs))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ERROR: failed to VIDIOC_REQBUFS\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 建立内存映射 */</span></span><br><span class="line">    buf.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;</span><br><span class="line">    buf.memory = V4L2_MEMORY_MMAP;</span><br><span class="line">    <span class="keyword">for</span> (n_buf = <span class="number">0</span>; n_buf &lt; VIDEO_BUFFER_COUNT; n_buf++)</span><br><span class="line">    &#123;</span><br><span class="line">        buf.index = n_buf;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> &gt; <span class="built_in">ioctl</span>(video_fd, VIDIOC_QUERYBUF, &amp;buf))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ERROR: failed to VIDIOC_QUERYBUF\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">/*void *mmap(void *addr, size_t len, int prot, int flags, int fd, off_t offset);</span></span><br><span class="line"><span class="comment">    在这个函数原型中：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    参数addr：指定映射的起始地址，通常设为NULL，由内核来分配</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    参数length：代表将文件中映射到内存的部分的长度。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    参数prot：映射区域的保护方式。可以为以下几种方式的组合：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    PROT_EXEC 映射区域可被执行</span></span><br><span class="line"><span class="comment">    PROT_READ 映射区域可被读取</span></span><br><span class="line"><span class="comment">    PROT_WRITE 映射区域可被写入</span></span><br><span class="line"><span class="comment">    PROT_NONE 映射区域不能存取</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    参数flags：映射区的特性标志位，常用的两个选项是：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    MAP_SHARD：写入映射区的数据会复制回文件，且运行其他映射文件的进程共享</span></span><br><span class="line"><span class="comment">    MAP_PRIVATE：对映射区的写入操作会产生一个映射区的复制，对此区域的修改不会写会原文件</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    参数fd：要映射到内存中的文件描述符，有open函数打开文件时返回的值。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    参数offset：文件映射的偏移量，通常设置为0，代表从文件最前方开始对应，offset必须是分页大小的整数倍。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    函数返回值：实际分配的内存的起始地址。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">        bufs_info[n_buf].length = buf.length;</span><br><span class="line">        bufs_info[n_buf].start = <span class="built_in">mmap</span>(<span class="literal">NULL</span>, buf.length,</span><br><span class="line">                                      PROT_READ | PROT_WRITE, MAP_SHARED,</span><br><span class="line">                                      video_fd, buf.m.offset);</span><br><span class="line">        <span class="keyword">if</span> (MAP_FAILED == bufs_info[n_buf].start)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ERROR: failed to mmap video buffer, size 0x%x\n&quot;</span>, buf.length);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 入队 */</span></span><br><span class="line">    <span class="keyword">for</span> (n_buf = <span class="number">0</span>; n_buf &lt; VIDEO_BUFFER_COUNT; n_buf++)</span><br><span class="line">    &#123;</span><br><span class="line">        buf.index = n_buf;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> &gt; <span class="built_in">ioctl</span>(video_fd, VIDIOC_QBUF, &amp;buf))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ERROR: failed to VIDIOC_QBUF\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    type = V4L2_BUF_TYPE_VIDEO_CAPTURE;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> &gt; <span class="built_in">ioctl</span>(video_fd, VIDIOC_STREAMON, &amp;type))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ERROR: failed to VIDIOC_STREAMON\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (startFlag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (n_buf = <span class="number">0</span>; n_buf &lt; VIDEO_BUFFER_COUNT; n_buf++)</span><br><span class="line">        &#123;</span><br><span class="line">            buf.index = n_buf;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> &gt; <span class="built_in">ioctl</span>(video_fd, VIDIOC_DQBUF, &amp;buf))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;ERROR: failed to VIDIOC_DQBUF\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function">QImage <span class="title">qImage</span><span class="params">((<span class="type">unsigned</span> <span class="type">char</span>*)bufs_info[n_buf].start, fmt.fmt.pix.width, fmt.fmt.pix.height, QImage::Format_RGB16)</span></span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 是否开启本地显示，开启本地显示可能会导致开启广播卡顿，它们互相制约 */</span></span><br><span class="line">            <span class="keyword">if</span> (startLocalDisplay)</span><br><span class="line">                <span class="function">emit <span class="title">imageReady</span><span class="params">(qImage)</span></span>;<span class="comment">//信号释放</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 是否开启广播，开启广播会导致本地显示卡顿，它们互相制约 */</span></span><br><span class="line">            <span class="keyword">if</span> (startBroadcast)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">/* udp套接字 */</span></span><br><span class="line">                QUdpSocket udpSocket;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* QByteArray类型 */</span></span><br><span class="line">                QByteArray byte;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* 建立一个用于IO读写的缓冲区 */</span></span><br><span class="line">                <span class="function">QBuffer <span class="title">buff</span><span class="params">(&amp;byte)</span></span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* image转为byte的类型，再存入buff */</span></span><br><span class="line">                qImage.<span class="built_in">save</span>(&amp;buff, <span class="string">&quot;JPEG&quot;</span>, <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* 转换为base64Byte类型 */</span></span><br><span class="line">                QByteArray base64Byte = byte.<span class="built_in">toBase64</span>();</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* 由udpSocket以广播的形式传输数据，端口号为8888 */</span></span><br><span class="line">                udpSocket.<span class="built_in">writeDatagram</span>(base64Byte.<span class="built_in">data</span>(), base64Byte.<span class="built_in">size</span>(), QHostAddress::Broadcast, <span class="number">8888</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> &gt; <span class="built_in">ioctl</span>(video_fd, VIDIOC_QBUF, &amp;buf))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;ERROR: failed to VIDIOC_QBUF\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">msleep</span>(<span class="number">800</span>);<span class="comment">//at lease 650</span></span><br><span class="line">    <span class="comment">/*与mmap函数成对使用的是munmap函数，它是用来解除映射的函数，原型如下：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    int munmap(void *start, size_t length)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    参数start：映射的起始地址</span></span><br><span class="line"><span class="comment">    参数length：文件中映射到内存的部分的长度*/</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VIDEO_BUFFER_COUNT; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">munmap</span>(bufs_info[i].start, buf.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(video_fd);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Mainwindow.h:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">Copyright © Deng Zhimao Co., Ltd. 2021-2030. All rights reserved.</span></span><br><span class="line"><span class="comment">* @projectName   video_server</span></span><br><span class="line"><span class="comment">* @brief         mainwindow.h</span></span><br><span class="line"><span class="comment">* @author        Deng Zhimao &amp; JAS</span></span><br><span class="line"><span class="comment">* @email         dengzhimao@alientek.com $1175595406@qq.com</span></span><br><span class="line"><span class="comment">* @link          www.openedv.com jasblog.top</span></span><br><span class="line"><span class="comment">* @date          2022-6-19</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QLabel&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QHBoxLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QCheckBox&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;capture_thread.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/* 用于显示捕获到的图像 */</span></span><br><span class="line">    QLabel *videoLabel;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 摄像头线程 */</span></span><br><span class="line">    CaptureThread *captureThread;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 开始捕获图像按钮 */</span></span><br><span class="line">    QPushButton *startCaptureButton;</span><br><span class="line">    QPushButton *startCaptureButton2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 用于开启本地图像显示 */</span></span><br><span class="line">    QCheckBox *checkBox1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 用于开启网络广播 */</span></span><br><span class="line">    QCheckBox *checkBox2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 重写大小事件 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resizeEvent</span><span class="params">(QResizeEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots: <span class="comment">//在这个区内声明的槽意味着只有类自己可以将信号与之相连接。</span></span><br><span class="line">    <span class="comment">/* 显示图像 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showImage</span><span class="params">(QImage)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 开始采集按钮被点击 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">startCaptureButtonClicked</span><span class="params">(<span class="type">bool</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">startCaptureButton2Clicked</span><span class="params">(<span class="type">bool</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br><span class="line">Mainwindow.cpp:</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setGeometry</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">800</span>, <span class="number">480</span>);<span class="comment">//从屏幕上（0，0）位置开始（即为最左上角的点），显示一个800*480的界面。</span></span><br><span class="line"></span><br><span class="line">    videoLabel = <span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="keyword">this</span>);</span><br><span class="line">    videoLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;未获取到图像数据或未开启服务端显示&quot;</span>);</span><br><span class="line">    videoLabel-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QWidget &#123;color: white;&#125;&quot;</span>);</span><br><span class="line">    videoLabel-&gt;<span class="built_in">setAlignment</span>(Qt::AlignCenter);<span class="comment">//setAlignment()主要将是消除布局中的空隙，让两个控件紧紧挨在一起。</span></span><br><span class="line">    videoLabel-&gt;<span class="built_in">resize</span>(<span class="number">640</span>, <span class="number">480</span>);</span><br><span class="line"></span><br><span class="line">    checkBox1 = <span class="keyword">new</span> <span class="built_in">QCheckBox</span>(<span class="keyword">this</span>);</span><br><span class="line">    checkBox2 = <span class="keyword">new</span> <span class="built_in">QCheckBox</span>(<span class="keyword">this</span>);</span><br><span class="line">    checkBox1-&gt;<span class="built_in">resize</span>(<span class="number">150</span>, <span class="number">50</span>);</span><br><span class="line">    checkBox2-&gt;<span class="built_in">resize</span>(<span class="number">150</span>, <span class="number">50</span>);</span><br><span class="line">    checkBox1-&gt;<span class="built_in">setText</span>(<span class="string">&quot;服务端显示&quot;</span>);</span><br><span class="line">    checkBox2-&gt;<span class="built_in">setText</span>(<span class="string">&quot;开启广播&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Style Sheets是文字性的设定，对于整个应用程序可以使用QApplication::setStyleSheet() 或者对应一个窗口可以使用QWidget::setStyleSheet()</span></span><br><span class="line">    checkBox1-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QCheckBox &#123;color: red;&#125;&quot;</span></span><br><span class="line">                             <span class="string">&quot;QCheckBox:indicator &#123;width: 40; height: 40;&#125;&quot;</span>);</span><br><span class="line">    checkBox2-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QCheckBox &#123;color: red;&#125;&quot;</span></span><br><span class="line">                             <span class="string">&quot;QCheckBox:indicator &#123;width: 40; height: 40;&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 按钮 */</span></span><br><span class="line">    startCaptureButton = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="keyword">this</span>);</span><br><span class="line">    startCaptureButton-&gt;<span class="built_in">setCheckable</span>(<span class="literal">true</span>);</span><br><span class="line">    startCaptureButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;开始采集摄像头数据&quot;</span>);</span><br><span class="line"></span><br><span class="line">    startCaptureButton2 = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="keyword">this</span>);</span><br><span class="line">    startCaptureButton2-&gt;<span class="built_in">setCheckable</span>(<span class="literal">true</span>);</span><br><span class="line">    startCaptureButton2-&gt;<span class="built_in">setText</span>(<span class="string">&quot;防伪按钮&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 设置背景颜色为黑色 */</span></span><br><span class="line">    QColor color = <span class="built_in">QColor</span>(Qt::black);</span><br><span class="line">    QPalette p;</span><br><span class="line">    p.<span class="built_in">setColor</span>(QPalette::Window, color);</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setPalette</span>(p);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 样式表 */</span></span><br><span class="line">    startCaptureButton-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QPushButton &#123;background-color: white; border-radius: 30&#125;&quot;</span></span><br><span class="line">                                      <span class="string">&quot;QPushButton:pressed  &#123;background-color: red;&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    captureThread = <span class="keyword">new</span> <span class="built_in">CaptureThread</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*信号与槽机制是QT非常核心的东西，通过信号与槽将不同的部分结合起来，信号与槽像是设计模式中的观察者模式（我自己觉得是这样），</span></span><br><span class="line"><span class="comment">     * 只关心信号何时发来，以及做如何相应，组件之间可以异步或者同步去处理事情。</span></span><br><span class="line"><span class="comment">     * 信号（Signal）：就是在特定情况下被发射的事件，例如PushButton 最常见的信号就是鼠标单击时发射的 clicked() 信号，</span></span><br><span class="line"><span class="comment">     * 一个 ComboBox 最常见的信号是选择的列表项变化时发射的 CurrentIndexChanged() 信号。GUI 程序设计的主要内容就是对界面上各组件的信号的响应，</span></span><br><span class="line"><span class="comment">     * 只需要知道什么情况下发射哪些信号，合理地去响应和处理这些信号就可以了。</span></span><br><span class="line"><span class="comment">     * 槽（Slot）：就是对信号响应的函数。</span></span><br><span class="line"><span class="comment">     * 槽就是一个函数，与一般的C++函数是一样的，可以定义在类的任何部分（public、private 或 protected），</span></span><br><span class="line"><span class="comment">     * 可以具有任何参数，也可以被直接调用。槽函数与一般的函数不同的是：</span></span><br><span class="line"><span class="comment">     * 槽函数可以与一个信号关联，当信号被发射时，关联的槽函数被自动执行。 */</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">connect</span>(startCaptureButton, <span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>(<span class="type">bool</span>)), captureThread, <span class="built_in">SLOT</span>(<span class="built_in">setThreadStart</span>(<span class="type">bool</span>)));</span><br><span class="line">    <span class="built_in">connect</span>(startCaptureButton, <span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>(<span class="type">bool</span>)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">startCaptureButtonClicked</span>(<span class="type">bool</span>)));</span><br><span class="line">    <span class="built_in">connect</span>(startCaptureButton2, <span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>(<span class="type">bool</span>)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">startCaptureButton2Clicked</span>(<span class="type">bool</span>)));</span><br><span class="line">    <span class="built_in">connect</span>(captureThread, <span class="built_in">SIGNAL</span>(<span class="built_in">imageReady</span>(QImage)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">showImage</span>(QImage)));</span><br><span class="line">    <span class="built_in">connect</span>(checkBox1, <span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>(<span class="type">bool</span>)), captureThread, <span class="built_in">SLOT</span>(<span class="built_in">setLocalDisplay</span>(<span class="type">bool</span>)));</span><br><span class="line">    <span class="built_in">connect</span>(checkBox2, <span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>(<span class="type">bool</span>)), captureThread, <span class="built_in">SLOT</span>(<span class="built_in">setBroadcast</span>(<span class="type">bool</span>)));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::showImage</span><span class="params">(QImage image)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    videoLabel-&gt;<span class="built_in">setPixmap</span>(QPixmap::<span class="built_in">fromImage</span>(image));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::resizeEvent</span><span class="params">(QResizeEvent *event)</span><span class="comment">//作为QT的事件函数在窗口控件大小获取，重置按钮位置用</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(event)<span class="comment">//用来避免编译器警告</span></span><br><span class="line">    startCaptureButton-&gt;<span class="built_in">move</span>((<span class="keyword">this</span>-&gt;<span class="built_in">width</span>() - <span class="number">200</span>) / <span class="number">2</span>, <span class="keyword">this</span>-&gt;<span class="built_in">height</span>() - <span class="number">80</span>);</span><br><span class="line">    startCaptureButton-&gt;<span class="built_in">resize</span>(<span class="number">200</span>, <span class="number">60</span>);</span><br><span class="line">    startCaptureButton2-&gt;<span class="built_in">move</span>(((<span class="keyword">this</span>-&gt;<span class="built_in">width</span>() - <span class="number">200</span>) / <span class="number">2</span>) <span class="number">-300</span>, <span class="keyword">this</span>-&gt;<span class="built_in">height</span>()- <span class="number">40</span>);</span><br><span class="line">    startCaptureButton2-&gt;<span class="built_in">resize</span>(<span class="number">100</span>, <span class="number">40</span>);</span><br><span class="line">    videoLabel-&gt;<span class="built_in">move</span>((<span class="keyword">this</span>-&gt;<span class="built_in">width</span>() - <span class="number">640</span>) / <span class="number">2</span>, (<span class="keyword">this</span>-&gt;<span class="built_in">height</span>() - <span class="number">480</span>) / <span class="number">2</span>);</span><br><span class="line">    checkBox1-&gt;<span class="built_in">move</span>(<span class="keyword">this</span>-&gt;<span class="built_in">width</span>() - <span class="number">130</span>, <span class="keyword">this</span>-&gt;<span class="built_in">height</span>() / <span class="number">2</span> + <span class="number">145</span>);</span><br><span class="line">    checkBox2-&gt;<span class="built_in">move</span>(<span class="keyword">this</span>-&gt;<span class="built_in">width</span>() - <span class="number">130</span>, <span class="keyword">this</span>-&gt;<span class="built_in">height</span>() / <span class="number">2</span> + <span class="number">190</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::startCaptureButtonClicked</span><span class="params">(<span class="type">bool</span> start)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (start)</span><br><span class="line">        startCaptureButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;停止采集摄像头数据&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        startCaptureButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;开始采集摄像头数据&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::startCaptureButton2Clicked</span><span class="params">(<span class="type">bool</span> start)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (start)</span><br><span class="line">        startCaptureButton2-&gt;<span class="built_in">setText</span>(<span class="string">&quot;by JAS &amp; LBC&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        startCaptureButton2-&gt;<span class="built_in">setText</span>(<span class="string">&quot;防伪按钮&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Main.cpp:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//程序入口</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//每一个qt程序只有一个，应用程序类</span></span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    <span class="comment">//窗口类，默认不显示</span></span><br><span class="line">    MainWindow w;</span><br><span class="line">    w.<span class="built_in">show</span>();</span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();<span class="comment">//a.exec();实际上是死循环，所以main函数实际上还没结束</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端：<br>Video_Client.pro：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#qt程序用到的模块</span></span><br><span class="line">QT       += core gui network</span><br><span class="line"><span class="comment">#兼容以前的版本</span></span><br><span class="line">greaterThan(QT_MAJOR_VERSION, 4): QT += widgets</span><br><span class="line"></span><br><span class="line">CONFIG += c++11</span><br><span class="line"></span><br><span class="line"><span class="comment"># The following define makes your compiler emit warnings if you use</span></span><br><span class="line"><span class="comment"># any Qt feature that has been marked deprecated (the exact warnings</span></span><br><span class="line"><span class="comment"># depend on your compiler). Please consult the documentation of the</span></span><br><span class="line"><span class="comment"># deprecated API in order to know how to port your code away from it.</span></span><br><span class="line">DEFINES += QT_DEPRECATED_WARNINGS</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can also make your code fail to compile if it uses deprecated APIs.</span></span><br><span class="line"><span class="comment"># In order to do so, uncomment the following line.</span></span><br><span class="line"><span class="comment"># You can also select to disable deprecated APIs only up to a certain version of Qt.</span></span><br><span class="line"><span class="comment">#DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x060000    # disables all the APIs deprecated before Qt 6.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改生成的应用程序的名字</span></span><br><span class="line">TARGET = 视频监控客户端v0.1-byJAS-炳川</span><br><span class="line"><span class="comment">#指定生成的makefile的类型 lib</span></span><br><span class="line">TEMPLATE = app</span><br><span class="line"></span><br><span class="line">SOURCES += \</span><br><span class="line">    main.cpp \</span><br><span class="line">    mainwindow.cpp</span><br><span class="line"></span><br><span class="line">HEADERS += \</span><br><span class="line">    mainwindow.h</span><br><span class="line"></span><br><span class="line"><span class="comment"># Default rules for deployment.</span></span><br><span class="line">qnx: target.path = /tmp/$<span class="variable">$&#123;TARGET&#125;</span>/bin</span><br><span class="line"><span class="keyword">else</span>: unix:!android: target.path = /opt/$<span class="variable">$&#123;TARGET&#125;</span>/bin</span><br><span class="line">!isEmpty(target.path): INSTALLS += target</span><br></pre></td></tr></table></figure>
<p>Mainwindow.h:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">Copyright © Deng Zhimao Co., Ltd. 2021-2030. All rights reserved.</span></span><br><span class="line"><span class="comment">* @projectName   video_client</span></span><br><span class="line"><span class="comment">* @brief         mainwindow.h</span></span><br><span class="line"><span class="comment">* @author        Deng Zhimao &amp; JAS</span></span><br><span class="line"><span class="comment">* @email         dengzhimao@alientek.com $1175595406@qq.com</span></span><br><span class="line"><span class="comment">* @link          www.openedv.com jasblog.top</span></span><br><span class="line"><span class="comment">* @date          2022-6-17</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QUdpSocket&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QLabel&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT  <span class="comment">//如果要使用信号和槽，必须加这个宏</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);<span class="comment">//构造与析构</span></span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/* 用于接收数据 */</span></span><br><span class="line">    QUdpSocket *udpSocket;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 显示接收的图像数据 */</span></span><br><span class="line">    QLabel *videoLabel;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resizeEvent</span><span class="params">(QResizeEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="comment">/* 图像更新 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">videoUpdate</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br><span class="line">Mainwindow.cpp:</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* 设置背景颜色为黑色 */</span></span><br><span class="line">    QColor color = <span class="built_in">QColor</span>(Qt::black);</span><br><span class="line">    QPalette p;</span><br><span class="line">    p.<span class="built_in">setColor</span>(QPalette::Window, color);</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setPalette</span>(p);</span><br><span class="line"></span><br><span class="line">    udpSocket = <span class="keyword">new</span> <span class="built_in">QUdpSocket</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">/* 绑定端口号 */</span></span><br><span class="line">    udpSocket-&gt;<span class="built_in">bind</span>(QHostAddress::Any, <span class="number">8888</span>);</span><br><span class="line"></span><br><span class="line">    videoLabel = <span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="keyword">this</span>);</span><br><span class="line">    videoLabel-&gt;<span class="built_in">resize</span>(<span class="number">640</span>, <span class="number">480</span>);</span><br><span class="line">    videoLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;未获取到图像数据&quot;</span>);</span><br><span class="line">    videoLabel-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QWidget &#123;color: white;&#125;&quot;</span>);</span><br><span class="line">    videoLabel-&gt;<span class="built_in">setAlignment</span>(Qt::AlignCenter);<span class="comment">//函数setAlignment()主要将是消除布局中的空隙，让两个控件紧紧挨在一起。</span></span><br><span class="line">    <span class="built_in">connect</span>(udpSocket, <span class="built_in">SIGNAL</span>(<span class="built_in">readyRead</span>()), <span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">videoUpdate</span>()));</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setGeometry</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">800</span>, <span class="number">480</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::videoUpdate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QByteArray datagram;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 数据大小重置 */</span></span><br><span class="line">    datagram.<span class="built_in">resize</span>(udpSocket-&gt;<span class="built_in">pendingDatagramSize</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 数据存放到datagram中 */</span></span><br><span class="line">    udpSocket-&gt;<span class="built_in">readDatagram</span>(datagram.<span class="built_in">data</span>(), datagram.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    QByteArray decryptedByte;</span><br><span class="line">    decryptedByte = QByteArray::<span class="built_in">fromBase64</span>(datagram.<span class="built_in">data</span>());</span><br><span class="line"></span><br><span class="line">    QImage image;</span><br><span class="line">    image.<span class="built_in">loadFromData</span>(decryptedByte);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 显示图像 */</span></span><br><span class="line">    videoLabel-&gt;<span class="built_in">setPixmap</span>(QPixmap::<span class="built_in">fromImage</span>(image));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::resizeEvent</span><span class="params">(QResizeEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(event)</span><br><span class="line">    videoLabel-&gt;<span class="built_in">move</span>((<span class="keyword">this</span>-&gt;<span class="built_in">width</span>() - <span class="number">640</span>) / <span class="number">2</span>, (<span class="keyword">this</span>-&gt;<span class="built_in">height</span>() - <span class="number">480</span>) / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Main.cpp:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//程序入口</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//每一个qt程序只有一个，应用程序类</span></span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    <span class="comment">//窗口类，默认不显示</span></span><br><span class="line">    MainWindow w;</span><br><span class="line">    w.<span class="built_in">show</span>();</span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();<span class="comment">//a.exec();&#125;实际上是死循环，所以main函数实际上还没结束</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://192.168.0.9:80">JAS-guanjieshi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://192.168.0.9/posts/10008/">http://192.168.0.9/posts/10008/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://192.168.0.9:80" target="_blank">JAS's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/ARM/">ARM</a><a class="post-meta__tags" href="/tags/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a><a class="post-meta__tags" href="/tags/OV5640/">OV5640</a><a class="post-meta__tags" href="/tags/Socket/">Socket</a><a class="post-meta__tags" href="/tags/V4L2/">V4L2</a><a class="post-meta__tags" href="/tags/C/">C++</a><a class="post-meta__tags" href="/tags/imx6ull/">imx6ull</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93/">网络传输</a><a class="post-meta__tags" href="/tags/QT/">QT</a><a class="post-meta__tags" href="/tags/%E8%BF%9C%E7%A8%8B%E8%A7%86%E9%A2%91%E5%BD%B1%E5%83%8F/">远程视频影像</a></div><div class="post_share"><div class="social-share" data-image="/img/qt7.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/10010/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zhiwenwaiguan.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">宿舍指纹锁（附程序）</div></div></a></div><div class="next-post pull-right"><a href="/posts/10007/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/68182.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">手势识别智能家居控制系统项目（附程序）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/10006/" title="基于粤嵌GEC6818开发板的智能家居控制系统（附程序）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/6818.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-21</div><div class="title">基于粤嵌GEC6818开发板的智能家居控制系统（附程序）</div></div></a></div><div><a href="/posts/10007/" title="手势识别智能家居控制系统项目（附程序）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/68182.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-21</div><div class="title">手势识别智能家居控制系统项目（附程序）</div></div></a></div><div><a href="/posts/10002/" title="稚晖君Quark-n使用笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/quark1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-19</div><div class="title">稚晖君Quark-n使用笔记</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">JAS-guanjieshi</div><div class="author-info__description">  不只是会写业务代码的  嵌入式攻城狮！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ScientificArt" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1175595406@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本博客仅作为个人项目、个人笔记展示平台，无商业用途！如有侵权请联系本人：        QQ:1175595406       VX:a117559540642</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%91%98%E8%A6%81"><span class="toc-number">1.</span> <span class="toc-text"> 摘要</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%9B%AE%E7%9A%84%E5%8F%8A%E6%84%8F%E4%B9%89"><span class="toc-number">2.</span> <span class="toc-text">一、目的及意义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%A7%86%E9%A2%91%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-number">3.</span> <span class="toc-text">二、视频监控系统的组成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.1.</span> <span class="toc-text">1、总体设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">3.2.</span> <span class="toc-text">2、功能分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E4%BD%95%E9%87%87%E9%9B%86%E8%A7%86%E9%A2%91%E6%95%B0%E6%8D%AE%E9%80%BB%E8%BE%91%E6%A6%82%E8%A6%81"><span class="toc-number">3.3.</span> <span class="toc-text">3、何采集视频数据逻辑概要</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%A7%86%E9%A2%91%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-number">4.</span> <span class="toc-text">三、视频监控系统的组成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">1.系统测试过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">四、总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E5%BD%95%EF%BC%9A%E6%BA%90%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81"><span class="toc-number">6.</span> <span class="toc-text"> 附录：源程序代码</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/10009/" title="Upcycling-智能家庭陪伴机器人"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/robotzmt.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Upcycling-智能家庭陪伴机器人"/></a><div class="content"><a class="title" href="/posts/10009/" title="Upcycling-智能家庭陪伴机器人">Upcycling-智能家庭陪伴机器人</a><time datetime="2022-09-08T08:56:00.000Z" title="发表于 2022-09-08 16:56:00">2022-09-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/10010/" title="宿舍指纹锁（附程序）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zhiwenwaiguan.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="宿舍指纹锁（附程序）"/></a><div class="content"><a class="title" href="/posts/10010/" title="宿舍指纹锁（附程序）">宿舍指纹锁（附程序）</a><time datetime="2022-09-07T08:56:00.000Z" title="发表于 2022-09-07 16:56:00">2022-09-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/10008/" title="基于qt的网络视频监控系统（附程序）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/qt7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于qt的网络视频监控系统（附程序）"/></a><div class="content"><a class="title" href="/posts/10008/" title="基于qt的网络视频监控系统（附程序）">基于qt的网络视频监控系统（附程序）</a><time datetime="2022-07-23T03:50:00.000Z" title="发表于 2022-07-23 11:50:00">2022-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/10007/" title="手势识别智能家居控制系统项目（附程序）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/68182.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手势识别智能家居控制系统项目（附程序）"/></a><div class="content"><a class="title" href="/posts/10007/" title="手势识别智能家居控制系统项目（附程序）">手势识别智能家居控制系统项目（附程序）</a><time datetime="2022-07-21T13:20:00.000Z" title="发表于 2022-07-21 21:20:00">2022-07-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/10006/" title="基于粤嵌GEC6818开发板的智能家居控制系统（附程序）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/6818.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于粤嵌GEC6818开发板的智能家居控制系统（附程序）"/></a><div class="content"><a class="title" href="/posts/10006/" title="基于粤嵌GEC6818开发板的智能家居控制系统（附程序）">基于粤嵌GEC6818开发板的智能家居控制系统（附程序）</a><time datetime="2022-07-21T06:10:00.000Z" title="发表于 2022-07-21 14:10:00">2022-07-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By JAS-guanjieshi</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'adKKmoloE9yGcoULXRRaFcVq-9Nh9j0Va',
      appKey: 'HwMHRaqs0JP6U91Ly00odivy',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":240,"height":220},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>