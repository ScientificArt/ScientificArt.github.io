<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>手势识别智能家居控制系统项目（附程序） | JAS's Blog</title><meta name="keywords" content="linux,IIC通信,串口通信,UDP通信,ARM,PAJ7620U2,GEC6818,DHT11,zigbee"><meta name="author" content="JAS-guanjieshi"><meta name="copyright" content="JAS-guanjieshi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文为基于粤嵌GEC6818开发板的手势识别智能家居控制系统项目实习项目的个人笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="手势识别智能家居控制系统项目（附程序）">
<meta property="og:url" content="http://192.168.0.9/posts/10007/index.html">
<meta property="og:site_name" content="JAS&#39;s Blog">
<meta property="og:description" content="本文为基于粤嵌GEC6818开发板的手势识别智能家居控制系统项目实习项目的个人笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://192.168.0.9/img/68182.png">
<meta property="article:published_time" content="2022-07-21T13:20:00.000Z">
<meta property="article:modified_time" content="2022-07-21T13:53:51.000Z">
<meta property="article:author" content="JAS-guanjieshi">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="IIC通信">
<meta property="article:tag" content="串口通信">
<meta property="article:tag" content="UDP通信">
<meta property="article:tag" content="ARM">
<meta property="article:tag" content="PAJ7620U2">
<meta property="article:tag" content="GEC6818">
<meta property="article:tag" content="DHT11">
<meta property="article:tag" content="zigbee">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://192.168.0.9/img/68182.png"><link rel="shortcut icon" href="/img/Batman.png"><link rel="canonical" href="http://192.168.0.9/posts/10007/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '手势识别智能家居控制系统项目（附程序）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-21 21:53:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">49</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E7%95%AA%E5%89%A7"><i class="fa-fw /bangumis/"></i><span> 0</span></a></li><li><a class="site-page child" href="/%E9%9F%B3%E4%B9%90"><i class="fa-fw /music/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/68182.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">JAS's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E7%95%AA%E5%89%A7"><i class="fa-fw /bangumis/"></i><span> 0</span></a></li><li><a class="site-page child" href="/%E9%9F%B3%E4%B9%90"><i class="fa-fw /music/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">手势识别智能家居控制系统项目（附程序）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-21T13:20:00.000Z" title="发表于 2022-07-21 21:20:00">2022-07-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-21T13:53:51.000Z" title="更新于 2022-07-21 21:53:51">2022-07-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/%E5%9F%BA%E4%BA%8E%E7%B2%A4%E5%B5%8CGEC6818%E5%BC%80%E5%8F%91%E6%9D%BF%E7%9A%84%E6%89%8B%E5%8A%BF%E8%AF%86%E5%88%AB%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/">基于粤嵌GEC6818开发板的手势识别智能家居控制系统项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="手势识别智能家居控制系统项目（附程序）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一、需求分析"><a href="#一、需求分析" class="headerlink" title="一、需求分析"></a>一、需求分析</h1><p>智能家居系统是一种近年来兴起的智能化系统，在家庭场合基本都能看到它的身影，各种家居通过一个智能控制终端来进行人机交互。本课题基于粤嵌GEC-6818开发平台，定制的Linux系统，通过C语言的编程，经过交叉编译环境，让编译的文件能够直接适用于ARM开发板。用7寸LCD电容式触摸屏作为人机互交的方式，做到可以LED控制、液晶屏检测、报警控制、电子相册、音乐播放、视频播放器、的功能，显示相应的界面。具有音频输出的功能，获取屏幕触摸点的坐标，实现界面上相应的功能。<br>本次为智能家居项目的进阶设计，在此基础上加入了zigbee温度采集，滑动控制，手势识别模块PAJ7620U2进行人机交互，UDP通信等。进一步加强了本人的中型工程的整合能力。<br>通过这次的设计，掌握了ARM的结构体系，了解了部分的Linux命令，对文件的读写操作等，初步掌握了交叉编译方式，加强了对嵌入式产品的认知。同时，在本课程设计时的调试、排错，让我们对C语言进行了一次查漏补缺，也巩固了C语言基础。让我们能够用团队的力量，对ARM系列的开发板进行开发，用固定的硬件设备实现多种功能，了解ARM开发的文件读取方式、交叉编译环境。扩大了我们的眼界，学会了无显示界面时使用Linux命令操作设备。</p>
<h1 id="二、功能设计"><a href="#二、功能设计" class="headerlink" title="二、功能设计"></a>二、功能设计</h1><p>  1、实现液晶屏显示界面<br>  2、电子相册功能-可以触屏控制相册的浏览也可以手势控制相册的浏览、滑屏控制（拓展（触屏）：顺序播放和随机播放相片），也可以在相册中添加图片和册删除图片<br>  3、MP3播放器功能-可以触屏控制音乐的播放、暂停、播放上一首、播放下一首;滑屏控制播放上一首、播放下一首;同时可以手势控制<br>  4、视频播放器功能<br>    -①触屏控制视频的播放、暂停、快进、快退、调节音量+- 、静音;同时可以手势控制<br>    -②滑屏控制快进、快退;③同时使用手势控制 （拓展（触屏）：播放下一个上一个视频，可以顺序播放和随机播放）<br>  5、通过串口与zigbee进行通信，能够通过zigbee检测温湿度并把温湿度数据传输给开发板，并且当温度高于一定阈值使得板载蜂鸣器响，同时可以手势控制<br>  6、可以通过开发板对另一个开发板进行操作(UDP通信），同时可以手势控制</p>
<h1 id="三、运行结果及分析（图片多为gif图，加载可能会缓慢）"><a href="#三、运行结果及分析（图片多为gif图，加载可能会缓慢）" class="headerlink" title="三、运行结果及分析（图片多为gif图，加载可能会缓慢）"></a>三、运行结果及分析（<em>图片多为gif图，加载可能会缓慢</em>）</h1><p>1、电子相册功能-可以触屏控制相册的浏览也可以手势控制相册的浏览、滑屏控制（拓展（触屏）：顺序播放和随机播放相片），也可以在相册中添加图片和册删除图片</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/xc.gif" alt="电子相册"></p>
<p>2、MP3播放器功能与视频播放器功能-仅做视频演示，因为均是同Mplayer实现。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/spss.gif" alt="视频界面"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/spss1.gif" alt="视频播放"></p>
<p>程序运行效果如上，功能正常，屏幕内容完美显示。<br>3、通过串口与zigbee进行通信，能够通过zigbee检测温湿度并把温湿度数据传输给开发板，并且当温度高于一定阈值使得板载蜂鸣器响，同时可以手势控制</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/wd.gif" alt="zigbee温度检测"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/zigbee.gif" alt="zigbee串口通信"></p>
<p>4、可以通过开发板对另一个开发板进行操作(UDP通信），同时可以手势控制</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src= "/img/loading.gif" data-src="/img/udp.gif" alt="UDP通信"></p>
<h1 id="附录：项目核心源程序"><a href="#附录：项目核心源程序" class="headerlink" title="附录：项目核心源程序"></a>附录：项目核心源程序</h1><p>从机程序：<br>IAR（zigbee）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ioCC2530.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DHT11.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="comment">// 使用宏定义去定义IO口  增强程序的可读性</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> YLED   P1_1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLED   P1_0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUT    P1_2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHT11  P0_4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LEDCLOSE  0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LEDOPEN   1</span></span><br><span class="line"><span class="comment">//#define uint unsigned int</span></span><br><span class="line"><span class="comment">//#define uchar unsigned char</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> RxBuf;</span><br><span class="line"><span class="comment">//定义接收缓冲区</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> Rx_flag;</span><br><span class="line"><span class="comment">//定义串口接收标志位</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> s1[<span class="number">6</span>]=<span class="string">&quot;te&quot;</span>;</span><br><span class="line"><span class="comment">//发送一段字符串到串口</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">uart0_send_string</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *p, <span class="type">int</span> len)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装一个延时函数，粗延时（软件延时），非常不精确</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay_time</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">   <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;n; i++);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//延时n微秒</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay_us</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;n; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;NOP&quot;</span>); <span class="comment">//什么都不干，空指令，消耗一个指令周期，跟 ; 是一样的</span></span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;NOP&quot;</span>);</span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;NOP&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//延时n毫秒</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay_ms</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">while</span>(n--)</span><br><span class="line">  &#123;</span><br><span class="line">    delay_us(<span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装函数实现IO口的初始化</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">init_led</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//对寄存器进行配置</span></span><br><span class="line">  P1SEL &amp;= <span class="number">0</span>;</span><br><span class="line">  P1DIR |= <span class="number">3</span>;  <span class="comment">// P1DIR=P1DIR|0x00000011</span></span><br><span class="line">  </span><br><span class="line">  BLED=LEDCLOSE;</span><br><span class="line">  YLED=LEDCLOSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//按键IO配置</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">init_key</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  P1SEL &amp;= ~<span class="number">0x4</span>;  <span class="comment">//P1SEL &amp;= ~0000 0100;  P1_2选择寄存器设置成0</span></span><br><span class="line">  P1DIR &amp;= ~<span class="number">0x4</span>;  <span class="comment">//P1_2方向寄存器设置成0</span></span><br><span class="line">  P1INP &amp;= ~<span class="number">0x4</span>;  <span class="comment">//P1_2输入模式寄存器设置成0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//按键中断配置函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">init_key_INT</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  P1IEN |= <span class="number">0x4</span>; <span class="comment">//打开P1_2中断使能：把寄存器P1IEN第2位置1 0000 0100 -&gt; 0x4</span></span><br><span class="line">  PICTL |= <span class="number">0x2</span>;  <span class="comment">//设为下降沿：把PICTL寄存器第1位置1    0000 0010 -&gt; 0x2</span></span><br><span class="line">  P1IFG = <span class="number">0</span>;       <span class="comment">//清空中断，以产生下次中断，置0</span></span><br><span class="line">  IEN2 = <span class="number">0x10</span>;        <span class="comment">//使能中断：把IEN2的第4位置1   0001 0000 -&gt; 16 -&gt; 0x10</span></span><br><span class="line">  EA = <span class="number">1</span>;         <span class="comment">//打开总中断开关，置1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将当前的中断向量地址设置为端口1中断</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> vector = P1INT_VECTOR</span></span><br><span class="line">__interrupt <span class="type">void</span> <span class="title function_">P1_ISR</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//unsigned char str[20] = &quot;Key press!!!&quot;;</span></span><br><span class="line">  YLED=!YLED;</span><br><span class="line">  <span class="comment">//黄灯状态变换</span></span><br><span class="line">  <span class="type">int</span> t=<span class="number">55</span>;</span><br><span class="line">  <span class="type">int</span> h=<span class="number">99</span>;</span><br><span class="line">  <span class="comment">//uart0_send_string(str, 20);</span></span><br><span class="line">  s1[<span class="number">0</span>]=t/<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>; <span class="comment">// 48 49 50 51  3+48==51  51就是‘3 ’ </span></span><br><span class="line">  s1[<span class="number">1</span>]=t%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">  s1[<span class="number">2</span>]=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  s1[<span class="number">3</span>]=h/<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>; <span class="comment">// 48 49 50 51  3+48==51  51就是‘3 ’ </span></span><br><span class="line">  s1[<span class="number">4</span>]=h%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">  s1[<span class="number">5</span>]=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">  <span class="keyword">while</span>(!BUT)</span><br><span class="line">  &#123;</span><br><span class="line">    uart0_send_string(s1,<span class="number">6</span>);</span><br><span class="line">    BLED=!BLED;</span><br><span class="line">    delay_ms(<span class="number">100</span>);</span><br><span class="line">    BLED=!BLED;</span><br><span class="line">    delay_ms(<span class="number">100</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  P1IFG=<span class="number">0</span>;  <span class="comment">//清空中断标志位</span></span><br><span class="line">  P1IF=<span class="number">0</span>;   <span class="comment">//清空中断标志位</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init_clock</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  CLKCONCMD &amp;= ~<span class="number">0x40</span>;     <span class="comment">//将CLKCONCMD寄存器第6位置0 0100 0000 -&gt; 0x40</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  while(1)</span></span><br><span class="line"><span class="comment">  &#123;</span></span><br><span class="line"><span class="comment">    if(CLKCONSTA &amp; 0x40 == 0)</span></span><br><span class="line"><span class="comment">      break;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">while</span>(CLKCONSTA &amp; <span class="number">0x40</span>);   <span class="comment">//检测CLKCONSTA寄存器的第6位是否是0，是的话再进行下一步</span></span><br><span class="line">  CLKCONCMD &amp;= ~<span class="number">0x47</span>;      <span class="comment">//将CLKCONCMD寄存器的第0,1,2都置0 0100 0111</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化串口函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">init_uart0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  PERCFG &amp;= ~<span class="number">0x01</span>;  <span class="comment">//位置1，将PERCFG的第0位，置0  0000 0001 -&gt; 0x01</span></span><br><span class="line">  P0SEL |= <span class="number">0x0c</span>;     <span class="comment">//配置成外设，将P0SEL的第2,3位，置1（0000 1100 -&gt;</span></span><br><span class="line">  U0CSR |= <span class="number">0x80</span>;     <span class="comment">//配置成UART模式，将第7位，置1</span></span><br><span class="line">  U0GCR |= <span class="number">11</span>;  <span class="comment">//115200波特率，整数部分BAUD_E=11</span></span><br><span class="line">  U0BAUD |= <span class="number">216</span>;      <span class="comment">//选择115200波特率，小数部分数值BAUD_M=216，与波特率寄存器相或。</span></span><br><span class="line">  U0UCR |= <span class="number">0x80</span>;<span class="comment">//无流控，8位数据位，清空缓冲区</span></span><br><span class="line">  U0CSR |= <span class="number">0X40</span>;        <span class="comment">//允许接收</span></span><br><span class="line">  UTX0IF = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">  URX0IF = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//串口0RX接收中断标志位清</span></span><br><span class="line">   </span><br><span class="line">  URX0IE = <span class="number">1</span>;</span><br><span class="line">  <span class="comment">//开串口0接收中断</span></span><br><span class="line">  EA=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> vector = URX0_VECTOR</span></span><br><span class="line">__interrupt <span class="type">void</span> <span class="title function_">URX0_ISR</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  URX0IF = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//清中断标志位</span></span><br><span class="line"></span><br><span class="line">  RxBuf = U0DBUF;<span class="comment">//将缓冲寄存器的数据给读出来</span></span><br><span class="line">  Rx_flag = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//接收标志位置1</span></span><br><span class="line">      Rx_flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span>(RxBuf)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;o&#x27;</span>:</span><br><span class="line">      BLED = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">      BLED = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">       BLED=!BLED;</span><br><span class="line">     delay_ms(<span class="number">100</span>);</span><br><span class="line">     BLED=!BLED;</span><br><span class="line">     delay_ms(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//发送一个字符到串口</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">uart0_send_char</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> data)</span></span><br><span class="line">&#123;</span><br><span class="line">  U0DBUF = data;</span><br><span class="line">  <span class="keyword">while</span>(UTX0IF == <span class="number">0</span>); <span class="comment">//等待上一个数据发送完毕后，再继续发送下一个数据</span></span><br><span class="line">  UTX0IF = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//发送一段字符串到串口</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">uart0_send_string</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *p, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;len; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    U0DBUF = *p;    <span class="comment">//*表示解引用，取得某个地址上的变量</span></span><br><span class="line">                    <span class="comment">//&amp;表示取地址，取得某个变量的地址</span></span><br><span class="line">    p++;</span><br><span class="line">    <span class="keyword">while</span>(UTX0IF == <span class="number">0</span>); <span class="comment">//等待上一个数据发送完毕后，再继续发送下一个数据</span></span><br><span class="line">    UTX0IF = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">DHT11_ReadByte</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> bit_value;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> value=<span class="number">0</span>;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> count;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span>(count=<span class="number">0</span>;count&lt;<span class="number">8</span>;count++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span>(!DHT11)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span>(!DHT11);  <span class="comment">//等待低半周期过去</span></span><br><span class="line">      <span class="comment">//判断是0还是1</span></span><br><span class="line">      delay_us(<span class="number">30</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(DHT11)</span><br><span class="line">      bit_value = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      bit_value = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    value &lt;&lt;= <span class="number">1</span>;          <span class="comment">//0  00  1   01  0   010 010</span></span><br><span class="line">    value |=  bit_value;</span><br><span class="line">    <span class="keyword">while</span>(DHT11);</span><br><span class="line">  &#125;              </span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">DHT11_Read</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *pTemp,<span class="type">unsigned</span> <span class="type">char</span> *pHum)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">//设置P0_4 输出</span></span><br><span class="line">   P0SEL &amp;=  ~(<span class="number">0x1</span> &lt;&lt; <span class="number">4</span>);</span><br><span class="line">   P0DIR |=   (<span class="number">0x1</span> &lt;&lt; <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//CC2530 主机启动读写信号 </span></span><br><span class="line">   DHT11 = <span class="number">0</span>;   <span class="comment">//拉低</span></span><br><span class="line">   delay_ms(<span class="number">19</span>); <span class="comment">//保持19ms</span></span><br><span class="line">   DHT11 = <span class="number">1</span>;   <span class="comment">//拉高</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//设置P0_4 输入</span></span><br><span class="line">   P0DIR |=   (<span class="number">0x1</span> &lt;&lt; <span class="number">4</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//等待DHT11应答</span></span><br><span class="line">   <span class="keyword">while</span>(DHT11);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//DHT11响应</span></span><br><span class="line">   <span class="keyword">if</span>(!DHT11)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="comment">//DHT11 响应信号</span></span><br><span class="line">      <span class="keyword">while</span>(!DHT11); <span class="comment">//等待低周期结束</span></span><br><span class="line">      <span class="keyword">while</span>(DHT11); <span class="comment">//等待高周期结束</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">//读取40bit数据</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">//读取湿度的整数值 </span></span><br><span class="line">      *pHum = DHT11_ReadByte();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//读取湿度的小数值，暂不使用 </span></span><br><span class="line">      DHT11_ReadByte();       </span><br><span class="line">      </span><br><span class="line">      <span class="comment">//读取温度的整数值 </span></span><br><span class="line">      *pTemp = DHT11_ReadByte();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//读取温度的小数值 ，暂不使用</span></span><br><span class="line">      DHT11_ReadByte();  </span><br><span class="line">      </span><br><span class="line">      <span class="comment">//读取校验值，忽略</span></span><br><span class="line">      DHT11_ReadByte();   </span><br><span class="line">     </span><br><span class="line">      DHT11 = <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main函数就是程序的入口，程序从这里开始运行</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span><span class="comment">//////</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> tem;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> hum;</span><br><span class="line">  <span class="type">int</span> t;</span><br><span class="line">  <span class="type">int</span> h;</span><br><span class="line">  <span class="comment">//unsigned char str[20] = &quot;helloworld&quot;; //字符串数组，里面就是一个一个的字符</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//unsigned char s2[3]=&quot;hu&quot;;</span></span><br><span class="line">  init_clock();   <span class="comment">//设置时钟频率为32MHz</span></span><br><span class="line">  </span><br><span class="line">  init_led();   <span class="comment">//初始化LED，让LED做好准备</span></span><br><span class="line">  init_key();   <span class="comment">//初始化按键IO</span></span><br><span class="line">  init_key_INT();   <span class="comment">//初始化按键中断  </span></span><br><span class="line">  init_uart0(); <span class="comment">//初始化串口0</span></span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>)  <span class="comment">//死循环，大括号中内容会循环执行</span></span><br><span class="line">  &#123;</span><br><span class="line">    </span><br><span class="line">     YLED=!YLED;</span><br><span class="line">     DHT11_Read(&amp;tem,&amp;hum);</span><br><span class="line">     t=(<span class="type">int</span>)tem;  <span class="comment">//35</span></span><br><span class="line">     s1[<span class="number">0</span>]=t/<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>; <span class="comment">// 48 49 50 51  3+48==51  51就是‘3 ’ </span></span><br><span class="line">     s1[<span class="number">1</span>]=t%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">     s1[<span class="number">2</span>]=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">     h=(<span class="type">int</span>)hum;  <span class="comment">//35</span></span><br><span class="line">     s1[<span class="number">3</span>]=h/<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>; <span class="comment">// 48 49 50 51  3+48==51  51就是‘3 ’ </span></span><br><span class="line">     s1[<span class="number">4</span>]=h%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">     s1[<span class="number">5</span>]=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">     uart0_send_string(s1,<span class="number">6</span>);</span><br><span class="line">     <span class="comment">//uart0_send_string(s2,8);</span></span><br><span class="line">     <span class="keyword">if</span>(t&gt;<span class="number">32</span>)</span><br><span class="line">     &#123;</span><br><span class="line">       BLED=!BLED;</span><br><span class="line">       delay_ms(<span class="number">100</span>);</span><br><span class="line">       BLED=!BLED;</span><br><span class="line">       delay_ms(<span class="number">100</span>);</span><br><span class="line">       BLED=!BLED;</span><br><span class="line">       delay_ms(<span class="number">100</span>);</span><br><span class="line">       BLED=!BLED;</span><br><span class="line">       delay_ms(<span class="number">100</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">//BLED=0;</span></span><br><span class="line">  <span class="comment">//  uart0_send_char(tem);</span></span><br><span class="line">   <span class="comment">// uart0_send_char(hum);</span></span><br><span class="line">    t=<span class="number">0</span>;</span><br><span class="line">    h=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    delay_ms(<span class="number">1500</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>udpre.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span>          <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span> <span class="comment">// for open</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span> <span class="comment">// for close</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED1   7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED2   8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED3   9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED4   10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED_ON   1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED_OFF  2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  OWNADDR  <span class="string">&quot;10.12.94.159&quot;</span>  <span class="comment">//我自己ubuntu的ip地址</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  OWNPORT  10000 <span class="comment">//我自己ubuntu的该程序的端口号</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  SERVERADDR <span class="string">&quot;10.12.94.249&quot;</span><span class="comment">//服务器的IP地址 也就是  对方的 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  SERVERPORT  20000  <span class="comment">//服务器的端口号  也就是  对方的 </span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">led_ctrl</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> led_num, <span class="type">unsigned</span> <span class="type">char</span> led_state)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//1、打开LED驱动文件---open()</span></span><br><span class="line">	<span class="type">int</span> led_fd;</span><br><span class="line">	<span class="comment">// /dev/led_drv---LED设备驱动文件</span></span><br><span class="line">    led_fd = open(<span class="string">&quot;/dev/led_drv&quot;</span>,O_RDWR);</span><br><span class="line">	<span class="keyword">if</span>(led_fd == <span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;open led failed&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2、向LED灯驱动写入灯号和灯的状态数据</span></span><br><span class="line">	<span class="type">char</span> led_buf[<span class="number">2</span>];</span><br><span class="line">	led_buf[<span class="number">1</span>]=led_num;led_buf[<span class="number">0</span>]=led_state;</span><br><span class="line">	write(led_fd, led_buf, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3、关闭LED灯----close()</span></span><br><span class="line">	close(led_fd);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//1、建立套接字（选择UDP协议 一定要选择这个 SOCK_DGRAM）</span></span><br><span class="line">	<span class="type">int</span> socketfd = socket(AF_INET,SOCK_DGRAM,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span>(socketfd == <span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;socketfd error\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//2、绑定自己的IP地址和端口号 ---这一步在客户端 可以省略</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">ownAddr</span>;</span><span class="comment">//定义一个IPV4结构体变量，初始化自己的信息</span></span><br><span class="line">	ownAddr.sin_family = AF_INET;<span class="comment">//IPV4</span></span><br><span class="line">	ownAddr.sin_port = htons(OWNPORT); <span class="comment">/*端口号*/</span></span><br><span class="line">	ownAddr.sin_addr.s_addr = inet_addr(OWNADDR);<span class="comment">//本地IP--&gt;网络IP</span></span><br><span class="line">	</span><br><span class="line">	bind(socketfd,(<span class="keyword">struct</span> sockaddr *)&amp;ownAddr,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in));</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//定义一个IPV4结构体变量，存储对方的IP地址和端口号</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">otherAddr</span>;</span></span><br><span class="line">	<span class="type">int</span> len = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in);<span class="comment">//一定要指定大小，作为参数传递进去</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//3、直接接收数据（聊天）</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		sleep(<span class="number">1</span>);</span><br><span class="line">		<span class="type">char</span> buf[<span class="number">1024</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">		<span class="type">int</span> ret = recvfrom(socketfd,buf,<span class="keyword">sizeof</span>(buf),<span class="number">0</span>, (<span class="keyword">struct</span> sockaddr *)&amp;otherAddr,&amp;len);</span><br><span class="line">		<span class="keyword">if</span>(ret &lt;=<span class="number">0</span>)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">switch</span> (buf[<span class="number">0</span>])</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">			led_ctrl(LED1,LED_ON);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">			led_ctrl(LED2,LED_ON);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">			led_ctrl(LED3,LED_ON);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">			led_ctrl(LED4,LED_ON);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">			led_ctrl(LED1,LED_OFF);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;f&#x27;</span>:</span><br><span class="line">			led_ctrl(LED2,LED_OFF);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">			led_ctrl(LED3,LED_OFF);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">			led_ctrl(LED4,LED_OFF);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;com[%s]:[%u]:%s\n&quot;</span>,inet_ntoa(otherAddr.sin_addr),ntohs(otherAddr.sin_port),buf); <span class="comment">//buf: li4给gebi    &quot;hello&quot; + 192.168.14.20</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//4、关闭 </span></span><br><span class="line">	close(socketfd);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>gec6818主机程序(写的比较匆忙，总共用时3天，运用了很多flag，还没做代码优化，仅供参考)：</strong></p>
<p>beep跟led的程序请参考上一篇博客：<a target="_blank" rel="noopener" href="https://jasblog.top/posts/10006/">https://jasblog.top/posts/10006/</a></p>
<p>main.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;arm_serial.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;touch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lcd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;font.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;beep.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;video.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dir.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;photo.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;music.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dht11usart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gesture.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;udp.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//模式标识：</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAIN 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PHOTO 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UDP 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HUMITURE 5</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">gs_catch_pthread</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (mode == MAIN)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (gs == Up || IIC_gs == Up)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				mode = PHOTO;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Down || IIC_gs == Down)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				mode = VIDEO;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Left || IIC_gs == Left)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				mode = MUSIC;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Right || IIC_gs == Right)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				mode = UDP;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (IIC_gs == Wave)</span><br><span class="line">			&#123;</span><br><span class="line">				mode == HUMITURE;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				Humiture_control();</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;HUMITURE open!\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (mode == PHOTO)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (gs == Up || IIC_gs == Up)</span><br><span class="line">			&#123;</span><br><span class="line">				delflag=<span class="number">1</span>;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Down || IIC_gs == Down)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;photo close!\n&quot;</span>);</span><br><span class="line">				mode=MAIN;</span><br><span class="line">				lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Left || IIC_gs == Left)</span><br><span class="line">			&#123;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				pic_flag++;</span><br><span class="line">				<span class="keyword">if</span>(pic_flag &gt; num)</span><br><span class="line">				&#123;</span><br><span class="line">					pic_flag = num;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;Last picture!\n&quot;</span>);</span><br><span class="line">					</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;Next picture\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Right || IIC_gs == Right)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				pic_flag--;</span><br><span class="line">				<span class="keyword">if</span>(pic_flag &lt; <span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;First picture!\n&quot;</span>);</span><br><span class="line">					pic_flag=<span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;Prev picture\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (IIC_gs == Wave)</span><br><span class="line">			&#123;</span><br><span class="line">				loopflag = <span class="number">1</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (IIC_gs == Forward)</span><br><span class="line">			&#123;</span><br><span class="line">				addflag = <span class="number">1</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (mode == VIDEO)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (gs == Up || IIC_gs == Up)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Down || IIC_gs == Down)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;video close!\n&quot;</span>);</span><br><span class="line">				mode=MAIN;</span><br><span class="line">				lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Left || IIC_gs == Left)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				videonextflag=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Right || IIC_gs == Right)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				videopreflag=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (IIC_gs == Wave)</span><br><span class="line">			&#123;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				videospflag=<span class="number">2</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (IIC_gs == Forward)</span><br><span class="line">			&#123;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				videospflag=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (mode == MUSIC)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (gs == Up || IIC_gs == Up)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Down || IIC_gs == Down)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;photo close!\n&quot;</span>);</span><br><span class="line">				mode=MAIN;</span><br><span class="line">				lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Left || IIC_gs == Left)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				musicnextflag=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Right || IIC_gs == Right)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				musicpreflag=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (IIC_gs == Forward)</span><br><span class="line">			&#123;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				musicspflag=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (mode == UDP)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (gs == Up || IIC_gs == Up)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Down || IIC_gs == Down)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;UDP close!\n&quot;</span>);</span><br><span class="line">				mode=MAIN;</span><br><span class="line">				lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Left || IIC_gs == Left)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				open_serial();</span><br><span class="line">				send_char(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">				close_serial();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (gs == Right || IIC_gs == Right)</span><br><span class="line">			&#123;</span><br><span class="line">				gs=<span class="number">0</span>;</span><br><span class="line">				IIC_gs=<span class="number">0</span>;</span><br><span class="line">				open_serial();</span><br><span class="line">				send_char(<span class="string">&#x27;o&#x27;</span>);</span><br><span class="line">				close_serial();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">gs_catch_init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">pthread_t</span> tid_gsc;</span><br><span class="line">	<span class="type">int</span> gsc_ret;</span><br><span class="line">	gsc_ret = pthread_create(&amp;tid_gsc, <span class="literal">NULL</span>,gs_catch_pthread, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span>(gsc_ret &lt; <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;create thread gs_catch_catch error&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tid_gsc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	Lcd_Init();</span><br><span class="line">	mode = MAIN;</span><br><span class="line">	get_gs_pthread_init();</span><br><span class="line">	get_xy_pthread_init();</span><br><span class="line">	IIC_gesture_init();</span><br><span class="line">	gs_catch_init();</span><br><span class="line">	lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(ts.x &gt; <span class="number">0</span> &amp;&amp; ts.x &lt; <span class="number">150</span> &amp;&amp; ts.y &gt; <span class="number">420</span> &amp;&amp; ts.y &lt; <span class="number">480</span> &amp;&amp; mode == MAIN || mode == HUMITURE)</span><br><span class="line">		&#123;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;real open!&quot;</span>);</span><br><span class="line">			Humiture_control();</span><br><span class="line">			mode=MAIN;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (ts.x &gt; <span class="number">144</span> &amp;&amp; ts.x &lt; <span class="number">359</span> &amp;&amp; ts.y &gt; <span class="number">80</span> &amp;&amp; ts.y &lt; <span class="number">227</span> &amp;&amp; mode == MAIN || mode == PHOTO)<span class="comment">//进入数码相册</span></span><br><span class="line">		&#123;</span><br><span class="line">			Humiture_thread_uninit();	</span><br><span class="line">			get_name(PIC);</span><br><span class="line">			mode = PHOTO;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			photoshow();</span><br><span class="line">			lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">			bzero(file_name,<span class="keyword">sizeof</span>(file_name));</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;<span class="number">15</span>;i++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;file_name[%d] = %s\n&quot;</span>,i,file_name[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			mode=MAIN;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(ts.x &gt; <span class="number">460</span> &amp;&amp; ts.x &lt; <span class="number">643</span> &amp;&amp; ts.y &gt; <span class="number">80</span> &amp;&amp; ts.y &lt; <span class="number">227</span> &amp;&amp; mode == MAIN || mode == VIDEO)</span><br><span class="line">		&#123;</span><br><span class="line">			mode = VIDEO;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			get_name(VIDEO);</span><br><span class="line">			lcd_show_bmp(<span class="string">&quot;ui/videotool.bmp&quot;</span>);</span><br><span class="line">			video_ts_show();</span><br><span class="line">			lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">			mode=MAIN;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(ts.x &gt; <span class="number">146</span> &amp;&amp; ts.x &lt; <span class="number">359</span> &amp;&amp; ts.y &gt; <span class="number">280</span> &amp;&amp; ts.y &lt; <span class="number">631</span> &amp;&amp; mode == MAIN || mode == MUSIC)</span><br><span class="line">		&#123;</span><br><span class="line">			mode = MUSIC;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			lcd_show_bmp(<span class="string">&quot;ui/musictool.bmp&quot;</span>);</span><br><span class="line">			musicplay();</span><br><span class="line">			mode=MAIN;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(ts.x &gt; <span class="number">460</span> &amp;&amp; ts.x &lt; <span class="number">643</span> &amp;&amp; ts.y &gt; <span class="number">280</span> &amp;&amp; ts.y &lt; <span class="number">631</span> &amp;&amp; mode == MAIN || mode == UDP)</span><br><span class="line">		&#123;</span><br><span class="line">			mode = UDP;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			lcd_show_bmp(<span class="string">&quot;ui/cameratool.bmp&quot;</span>);</span><br><span class="line">			udp_init();</span><br><span class="line">			mode=MAIN;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//关闭字体，关闭画板</span></span><br><span class="line">	fontUnload(f);</span><br><span class="line">	destroyBitmap(bm);	</span><br><span class="line">	Lcd_UnInit();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>arm_serial.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;arm_serial.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义完成串口参数配置的函数</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">set_serial_uart1</span><span class="params">(<span class="type">int</span> ser_fd)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">termios</span> <span class="title">termios_new</span>;</span></span><br><span class="line">	<span class="comment">// 将结构体清零，</span></span><br><span class="line">	bzero( &amp;termios_new, <span class="keyword">sizeof</span>(termios_new));</span><br><span class="line">	<span class="comment">/*原始模式*/</span></span><br><span class="line">	cfmakeraw(&amp;termios_new);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*波特率为115200*/</span></span><br><span class="line">	termios_new.c_cflag=(B115200);</span><br><span class="line">	termios_new.c_cflag |= CLOCAL | CREAD;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*8位数据位*/</span></span><br><span class="line">	termios_new.c_cflag &amp;= ~CSIZE;</span><br><span class="line">	termios_new.c_cflag |= CS8;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*无奇偶校验位*/</span></span><br><span class="line">	termios_new.c_cflag &amp;= ~PARENB;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*1位停止位*/</span></span><br><span class="line">	termios_new.c_cflag &amp;= ~CSTOPB;</span><br><span class="line">	<span class="comment">/*清除串口缓冲区*/</span></span><br><span class="line">	tcflush( ser_fd,TCIOFLUSH);</span><br><span class="line">	termios_new.c_cc[VTIME] = <span class="number">0</span>;</span><br><span class="line">	termios_new.c_cc[VMIN] = <span class="number">4</span>;</span><br><span class="line">	tcflush ( ser_fd, TCIOFLUSH);</span><br><span class="line">	<span class="comment">/*串口设置使能*/</span></span><br><span class="line">	tcsetattr( ser_fd ,TCSANOW,&amp;termios_new);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 自定义打开串口</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">open_serial</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 打开开发板的串口1（作为扩展的串口）</span></span><br><span class="line">	ser_fd = open(DEVICE_NAME,O_RDWR);</span><br><span class="line">	<span class="keyword">if</span>(ser_fd&lt;<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;open serial1 failed!\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 对串口1进行配置</span></span><br><span class="line">	set_serial_uart1(ser_fd);</span><br><span class="line">	<span class="comment">// 判断配置是否成功</span></span><br><span class="line">	<span class="keyword">if</span>(fcntl(ser_fd, F_SETFL,<span class="number">0</span>)&lt;<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	tcdrain(ser_fd);   		<span class="comment">//通用终端控制</span></span><br><span class="line">	tcflush(ser_fd,TCIOFLUSH);<span class="comment">//刷新缓冲区</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 自定义发送信息的函数</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">send_msg</span><span class="params">(<span class="type">char</span> msg[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 发送指令（协调器来接收）</span></span><br><span class="line">	write(ser_fd,msg,<span class="number">16</span>);</span><br><span class="line">	<span class="comment">// 刷新缓冲区</span></span><br><span class="line">	tcflush(ser_fd,TCIOFLUSH);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">send_char</span><span class="params">(<span class="type">char</span> msg)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 发送指令（协调器来接收）</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,msg);</span><br><span class="line">	write(ser_fd,&amp;msg,<span class="number">8</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 刷新缓冲区</span></span><br><span class="line">	tcflush(ser_fd,TCIOFLUSH);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 自定义串口接受信息的函数</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">recv_msg</span><span class="params">(<span class="type">char</span> msg[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	read(ser_fd,msg,<span class="number">16</span>);</span><br><span class="line">	<span class="comment">//printf(&quot;%s&quot;,msg);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 自定义串口的关闭函数</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">close_serial</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	close(ser_fd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>arm_serial.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __ARM_SERIAL_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __ARM_SERIAL_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/videodev2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;termios.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 宏定义了6818开发板上面的串口1的驱动路径</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEVICE_NAME <span class="string">&quot;/dev/ttySAC1&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ser_fd;</span><br><span class="line"><span class="type">int</span> <span class="title function_">open_serial</span><span class="params">()</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">send_msg</span><span class="params">(<span class="type">char</span> msg[<span class="number">16</span>])</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">recv_msg</span><span class="params">(<span class="type">char</span> msg[<span class="number">16</span>])</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">close_serial</span><span class="params">()</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">send_char</span><span class="params">(<span class="type">char</span> msg)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>dht11usart.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dht11usart.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">pthread_t</span> tid_dht=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> dht11flag=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">Humiture_thread</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">	font_init(<span class="number">24</span>);</span><br><span class="line">	<span class="type">char</span> str[<span class="number">64</span>];</span><br><span class="line">	<span class="type">char</span> str1[<span class="number">64</span>];</span><br><span class="line">	<span class="type">char</span> DHT11_buf[<span class="number">6</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	open_serial();</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		recv_msg(DHT11_buf);</span><br><span class="line">		<span class="built_in">sprintf</span>(str,DHT11_buf);</span><br><span class="line">		<span class="built_in">sprintf</span>(str1,<span class="string">&quot;当前温度:\n当前湿度:&quot;</span>);</span><br><span class="line">		create_map(<span class="number">100</span>,<span class="number">50</span>,WHITE);</span><br><span class="line">		create_font(<span class="number">81</span>,<span class="number">0</span>,str,RED);</span><br><span class="line">		create_font(<span class="number">0</span>,<span class="number">0</span>,str1,RED);</span><br><span class="line">		show_font_to_lcd(lcd-&gt;mp,<span class="number">0</span>,<span class="number">430</span>,bm);</span><br><span class="line">		<span class="keyword">if</span> ((DHT11_buf[<span class="number">0</span>]-<span class="string">&#x27;0&#x27;</span>)&gt;<span class="number">3</span> &amp;&amp; (DHT11_buf[<span class="number">1</span>]-<span class="string">&#x27;0&#x27;</span>)&gt;<span class="number">2</span> || (DHT11_buf[<span class="number">4</span>]-<span class="string">&#x27;0&#x27;</span>)&gt;<span class="number">9</span> &amp;&amp; (DHT11_buf[<span class="number">5</span>]-<span class="string">&#x27;0&#x27;</span>)&gt;<span class="number">2</span> )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;dangrous humiture!&quot;</span>);</span><br><span class="line">			beep_ctrl(BEEP_ON);</span><br><span class="line">			usleep(<span class="number">100000</span>);</span><br><span class="line">			beep_ctrl(BEEP_OFF);</span><br><span class="line">			usleep(<span class="number">100000</span>);</span><br><span class="line">			beep_ctrl(BEEP_ON);</span><br><span class="line">			usleep(<span class="number">100000</span>);</span><br><span class="line">			beep_ctrl(BEEP_OFF);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	close_serial();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">Humiture_thread_init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret2 = pthread_create(&amp;tid_dht, <span class="literal">NULL</span>,Humiture_thread, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span>(ret2 &lt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">&quot;create ts_thread error&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">Humiture_thread_uninit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (dht11flag)</span><br><span class="line">	&#123;</span><br><span class="line">		dht11flag = <span class="number">0</span>;</span><br><span class="line">		pthread_cancel(tid_dht);</span><br><span class="line">		close_serial();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">Humiture_control</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!dht11flag)</span><br><span class="line">    &#123;</span><br><span class="line">        Humiture_thread_init();</span><br><span class="line">        dht11flag = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (dht11flag)</span><br><span class="line">    &#123;</span><br><span class="line">        dht11flag = <span class="number">0</span>;</span><br><span class="line">        pthread_cancel(tid_dht);</span><br><span class="line">        lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">        fontUnload(f);</span><br><span class="line">        destroyBitmap(bm);	</span><br><span class="line">        close_serial();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>dht11usart.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DHT11USART_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DHT11USART_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lcd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;beep.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;arm_serial.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;font.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> dht11flag;</span><br><span class="line"><span class="type">int</span> <span class="title function_">Humiture_control</span><span class="params">()</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">Humiture_thread_uninit</span><span class="params">()</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>dir.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dir.h&quot;</span></span></span><br><span class="line"><span class="type">char</span> file_name[<span class="number">15</span>][<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_name</span><span class="params">(<span class="type">char</span> dirname)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">5</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	DIR *dir_fd;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> *<span class="title">readdirs</span> =</span> <span class="built_in">calloc</span>(<span class="number">1</span>,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> dirent));</span><br><span class="line">	<span class="keyword">if</span> (dirname == PIC)</span><br><span class="line">		dir_fd =  opendir(<span class="string">&quot;pic/&quot;</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (dirname == UI)</span><br><span class="line">		dir_fd =  opendir(<span class="string">&quot;ui/&quot;</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (dirname == VIDEO)</span><br><span class="line">		dir_fd =  opendir(<span class="string">&quot;video/&quot;</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (dirname == MUSIC)</span><br><span class="line">		dir_fd =  opendir(<span class="string">&quot;music/&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>((readdirs = readdir(dir_fd)) != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">strlen</span>(readdirs-&gt;d_name)&lt;=<span class="number">4</span>)</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		bzero(buf,<span class="number">0</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(buf,&amp;(readdirs-&gt;d_name[<span class="built_in">strlen</span>(readdirs-&gt;d_name) - <span class="number">4</span>]),<span class="number">4</span>);</span><br><span class="line">		buf[<span class="number">4</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;buf= %s \n&quot;</span>,buf);</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf,<span class="string">&quot;.bmp&quot;</span>) == <span class="number">0</span> &amp;&amp; (dirname == PIC || UI ))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">strcpy</span>(file_name[i],readdirs-&gt;d_name);</span><br><span class="line">			i++;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,readdirs-&gt;d_name);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf,<span class="string">&quot;.mp4&quot;</span>) == <span class="number">0</span> &amp;&amp; (dirname == VIDEO))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">strcpy</span>(file_name[i],readdirs-&gt;d_name);</span><br><span class="line">			i++;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,readdirs-&gt;d_name);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf,<span class="string">&quot;.mp3&quot;</span>) == <span class="number">0</span> &amp;&amp; (dirname == MUSIC))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">strcpy</span>(file_name[i],readdirs-&gt;d_name);</span><br><span class="line">			i++;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,readdirs-&gt;d_name);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;<span class="number">15</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;file_name[%d] = %s\n&quot;</span>,i,file_name[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	closedir(dir_fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>dir.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DIR_h__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DIR_h__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dirent.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIC 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UI 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VIDEO 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MUSIC 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> file_name[<span class="number">15</span>][<span class="number">20</span>];</span><br><span class="line"><span class="type">void</span> <span class="title function_">get_name</span><span class="params">(<span class="type">char</span> dirname)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p><strong>特别注意：LCD字库libfont.a等可以在网上寻找此处不在贴出</strong><br>font.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;font.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LcdDevice</span>* <span class="title">lcd</span>=</span><span class="literal">NULL</span>;<span class="comment">//lcd屏幕指针</span></span><br><span class="line">font *f=<span class="literal">NULL</span>;<span class="comment">//字体指针</span></span><br><span class="line">bitmap *bm=<span class="literal">NULL</span>;<span class="comment">//内存映射指针</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化Lcd</span></span><br><span class="line"><span class="keyword">struct</span> LcdDevice *<span class="title function_">init_lcd</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *device)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//申请空间</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">LcdDevice</span>* <span class="title">lcd</span> =</span> <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> LcdDevice));</span><br><span class="line">	<span class="keyword">if</span>(lcd == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line">	<span class="comment">//1打开设备</span></span><br><span class="line">	lcd-&gt;fd = open(device, O_RDWR);</span><br><span class="line">	<span class="keyword">if</span>(lcd-&gt;fd &lt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;open lcd fail&quot;</span>);</span><br><span class="line">		<span class="built_in">free</span>(lcd);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//映射</span></span><br><span class="line">	lcd-&gt;mp = mmap(<span class="literal">NULL</span>,<span class="number">800</span>*<span class="number">480</span>*<span class="number">4</span>,PROT_READ|PROT_WRITE,MAP_SHARED,lcd-&gt;fd,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> lcd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化字体大小</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">font_init</span><span class="params">(<span class="type">int</span> num)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//初始化Lcd</span></span><br><span class="line">	lcd = init_lcd(<span class="string">&quot;/dev/fb0&quot;</span>);</span><br><span class="line">			</span><br><span class="line">	<span class="comment">//打开字体----210板子没有----需要把6818中字体文件传输到210的开发板上</span></span><br><span class="line">	f = fontLoad(<span class="string">&quot;/usr/share/fonts/DroidSansFallback.ttf&quot;</span>);</span><br><span class="line">	  </span><br><span class="line">	<span class="comment">//字体大小的设置：范围是1~72，但尽量选择字库中的字体大小</span></span><br><span class="line">	fontSetSize(f,num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个宽为W,高为H的颜色为mapcolor的画布，</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">create_map</span><span class="params">(<span class="type">int</span> W,<span class="type">int</span> H,<span class="type">unsigned</span> <span class="type">int</span> mapcolor)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> A,R,G,B;</span><br><span class="line">	A= (mapcolor&gt;&gt;<span class="number">24</span>);</span><br><span class="line">	R= (mapcolor&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">	G= (mapcolor&gt;&gt; <span class="number">8</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">	B= (mapcolor&gt;&gt; <span class="number">0</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">	bm = createBitmapWithInit(W,H,<span class="number">4</span>,getColor(A,B,G,R)); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在画布的（X,Y）坐标开始中写一个fontcolor颜色的buf文字</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">create_font</span><span class="params">(<span class="type">int</span> X,<span class="type">int</span> Y,<span class="type">char</span> *buf,<span class="type">unsigned</span> <span class="type">int</span> fontcolor)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> A,R,G,B;</span><br><span class="line">	A=  fontcolor&gt;&gt;<span class="number">24</span>;</span><br><span class="line">	R= (fontcolor&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">	G= (fontcolor&gt;&gt; <span class="number">8</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">	B= (fontcolor&gt;&gt; <span class="number">0</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">	fontPrint(f,bm,X,Y,buf,getColor(A,B,G,R),<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>font.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __font_h__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __font_h__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> color u32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> getColor(a, b, c, d) (a|b&lt;&lt;8|c&lt;&lt;16|d&lt;&lt;24)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> u8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">short</span> u16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> u32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> u64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> s8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">short</span> s16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> s32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> s64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">stbtt_fontinfo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   <span class="type">void</span>           * userdata;</span><br><span class="line">   <span class="type">unsigned</span> <span class="type">char</span>  * data;              <span class="comment">// pointer to .ttf file</span></span><br><span class="line">   <span class="type">int</span>              fontstart;         <span class="comment">// offset of start of font</span></span><br><span class="line"></span><br><span class="line">   <span class="type">int</span> numGlyphs;                     <span class="comment">// number of glyphs, needed for range checking</span></span><br><span class="line"></span><br><span class="line">   <span class="type">int</span> loca,head,glyf,hhea,hmtx,kern; <span class="comment">// table locations as offset from start of .ttf</span></span><br><span class="line">   <span class="type">int</span> index_map;                     <span class="comment">// a cmap mapping for our chosen character encoding</span></span><br><span class="line">   <span class="type">int</span> indexToLocFormat;              <span class="comment">// format needed to map from glyph index to glyph</span></span><br><span class="line">&#125; stbtt_fontinfo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">	u32 height;</span><br><span class="line">	u32 width;</span><br><span class="line">	u32 byteperpixel;</span><br><span class="line">	u8 *<span class="built_in">map</span>;</span><br><span class="line">&#125;bitmap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">	stbtt_fontinfo *info;</span><br><span class="line">	u8 *buffer;</span><br><span class="line">	<span class="type">float</span> scale;</span><br><span class="line">&#125;font;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> <span class="title">LcdDevice</span>* <span class="title">lcd</span>;</span><span class="comment">//lcd屏幕指针</span></span><br><span class="line"><span class="keyword">extern</span> font *f;<span class="comment">//字体指针</span></span><br><span class="line"><span class="keyword">extern</span> bitmap *bm;<span class="comment">//内存映射指针</span></span><br><span class="line"><span class="comment">//lcd设备结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LcdDevice</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">int</span> fd;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> *mp; <span class="comment">//保存映射首地址</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">void</span> <span class="title function_">font_init</span><span class="params">(<span class="type">int</span> num)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">create_map</span><span class="params">(<span class="type">int</span> W,<span class="type">int</span> H,<span class="type">unsigned</span> <span class="type">int</span> mapcolor)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">create_font</span><span class="params">(<span class="type">int</span> X,<span class="type">int</span> Y,<span class="type">char</span> *buf,<span class="type">unsigned</span> <span class="type">int</span> fontcolor)</span>;</span><br><span class="line"><span class="comment">//1.初始化字库 </span></span><br><span class="line">font *<span class="title function_">fontLoad</span><span class="params">(<span class="type">char</span> *fontPath)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.设置字体的大小 </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fontSetSize</span><span class="params">(font *f, s32 pixels)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.设置字体输出框的大小</span></span><br><span class="line">bitmap *<span class="title function_">createBitmap</span><span class="params">(u32 width, u32 height, u32 byteperpixel)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可以指定输出框的颜色</span></span><br><span class="line">bitmap *<span class="title function_">createBitmapWithInit</span><span class="params">(u32 width, u32 height, u32 byteperpixel, color c)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> LcdDevice *<span class="title function_">init_lcd</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *device)</span>;</span><br><span class="line"><span class="comment">//4.把字体输出到输出框中</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fontPrint</span><span class="params">(font *f, bitmap *screen, s32 x, s32 y, <span class="type">char</span> *text, color c, s32 maxWidth)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.把输出框的所有信息显示到LCD屏幕中 </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">show_font_to_lcd</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *p,<span class="type">int</span> px,<span class="type">int</span> py,bitmap *bm)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭字体库</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fontUnload</span><span class="params">(font *f)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭bitmap</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">destroyBitmap</span><span class="params">(bitmap *bm)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>gesture.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gesture.h&quot;</span></span></span><br><span class="line"><span class="type">int</span> fd;</span><br><span class="line"><span class="type">pthread_t</span> tid_iicgs;</span><br><span class="line"><span class="type">char</span> IIC_gs=<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> <span class="title function_">IIC_gesture_get</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> tmp=<span class="number">-1</span>;</span><br><span class="line">	read(fd,&amp;tmp,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span>(tmp&gt;=<span class="number">1</span> &amp;&amp; tmp&lt;=<span class="number">9</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%x\n&quot;</span>,tmp);</span><br><span class="line">		<span class="keyword">switch</span>(tmp)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">1</span>:<span class="built_in">printf</span>(<span class="string">&quot;Up\n&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">2</span>:<span class="built_in">printf</span>(<span class="string">&quot;Down\n&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">3</span>:<span class="built_in">printf</span>(<span class="string">&quot;Left\n&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">4</span>:<span class="built_in">printf</span>(<span class="string">&quot;Right\n&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">5</span>:<span class="built_in">printf</span>(<span class="string">&quot;Forward\n&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">6</span>:<span class="built_in">printf</span>(<span class="string">&quot;Backward\n&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">7</span>:<span class="built_in">printf</span>(<span class="string">&quot;Clockwise\n&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">8</span>:<span class="built_in">printf</span>(<span class="string">&quot;AntiClockwise\n&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">9</span>:<span class="built_in">printf</span>(<span class="string">&quot;Wave\n&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>:<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">get_IIC_gesture</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		IIC_gs=IIC_gesture_get();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">IIC_gesture_init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   fd = open(<span class="string">&quot;/dev/IIC_drv&quot;</span>, O_RDWR);</span><br><span class="line">	<span class="keyword">if</span>(fd &lt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;devok!\n&quot;</span>);</span><br><span class="line">	<span class="type">int</span> get_iicgs_ret;</span><br><span class="line">	get_iicgs_ret = pthread_create(&amp;tid_iicgs, <span class="literal">NULL</span>,get_IIC_gesture, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span>(get_iicgs_ret &lt; <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;create thread get_xy error&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">IIC_gesture_uninit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	close(fd);</span><br><span class="line">	pthread_cancel(tid_iicgs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>gesture.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __GESTURE_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __GESTURE_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pthread.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Up 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Down 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Left 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Right 4</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Forward 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Backward 6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Clockwise 7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AntiClockwise 8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Wave 9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> IIC_gs;</span><br><span class="line"><span class="type">int</span> <span class="title function_">IIC_gesture_init</span><span class="params">()</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">IIC_gesture_uninit</span><span class="params">()</span>;</span><br><span class="line"><span class="type">char</span> <span class="title function_">IIC_gesture_get</span><span class="params">()</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>music.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;music.h&quot;</span></span></span><br><span class="line"><span class="type">char</span> musicpreflag=<span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> musicnextflag=<span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> musicspflag=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">init_mplayer2</span><span class="params">()</span><span class="comment">//创建一个管道文件并且打开它，返回管道文件的文件描述符</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//创建一个管道文件</span></span><br><span class="line">	<span class="type">int</span> ret = mkfifo(<span class="string">&quot;/tmp/myfifo2&quot;</span>, <span class="number">0777</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="number">-1</span> == ret)</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;mkfifo failed&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> fd = open(<span class="string">&quot;/tmp/myfifo2&quot;</span>, O_RDWR);</span><br><span class="line">	<span class="keyword">if</span>(<span class="number">-1</span> == fd)</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;open fifo failed&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> fd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">musicplay</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> fd_fifo = init_mplayer2();</span><br><span class="line">	<span class="type">char</span> a[]=&#123;<span class="string">&quot;mplayer -slave -quiet -input file=/tmp/myfifo2 music/&quot;</span>&#125;;</span><br><span class="line">	<span class="type">char</span> b[]=&#123;<span class="string">&quot; &amp;&quot;</span>&#125;;</span><br><span class="line">	get_name(MUSIC);</span><br><span class="line">	<span class="type">char</span> strCat1[<span class="number">15</span>][<span class="number">100</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">sprintf</span>(strCat1[i],<span class="string">&quot;%s%s%s&quot;</span>,a,file_name[i],b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;--------------------------------%d-----------------------\n&quot;</span>, __LINE__);</span><br><span class="line">	<span class="type">bool</span> spflag = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> flag2 = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> vflag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(ts.x&gt;<span class="number">320</span> &amp;&amp; ts.x&lt;<span class="number">460</span> &amp;&amp; ts.y&gt;<span class="number">111</span> &amp;&amp; ts.y&lt;<span class="number">270</span>  )   <span class="comment">//上边播放音乐</span></span><br><span class="line">		&#123;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span> (flag2 == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				flag2++;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;play!\n&quot;</span>);</span><br><span class="line">				system(strCat1[vflag]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (mode == MAIN)</span><br><span class="line">			&#123;</span><br><span class="line">				flag2=<span class="number">0</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(ts.y&gt;<span class="number">360</span> &amp;&amp; ts.y&lt;<span class="number">480</span> ||  mode == MAIN || musicpreflag==<span class="number">1</span> || musicnextflag==<span class="number">1</span> || musicspflag==<span class="number">1</span> )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">342</span> &amp;&amp; ts.x&lt;<span class="number">430</span> || musicspflag==<span class="number">1</span>)  <span class="comment">//暂停/继续</span></span><br><span class="line">			&#123;</span><br><span class="line">				musicspflag =<span class="number">0</span>;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;--------line:%d---------------\n&quot;</span>, __LINE__);</span><br><span class="line">				<span class="keyword">if</span>(spflag == <span class="number">0</span>)      <span class="comment">//暂停</span></span><br><span class="line">				&#123;		</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;--------line:%d--------flag:%d-------\n&quot;</span>, __LINE__, spflag);</span><br><span class="line">					system(<span class="string">&quot;killall -SIGSTOP mplayer&quot;</span>);</span><br><span class="line">					spflag = <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(spflag== <span class="number">1</span>)    <span class="comment">//继续</span></span><br><span class="line">				&#123;	</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;--------line:%d--------flag:%d-------\n&quot;</span>, __LINE__, spflag);</span><br><span class="line">					system(<span class="string">&quot;killall -SIGCONT mplayer&quot;</span>);</span><br><span class="line">					spflag = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">550</span> &amp;&amp; ts.x&lt;<span class="number">600</span>)  <span class="comment">//降音量</span></span><br><span class="line">			&#123;	</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;volume-10.........................\n&quot;</span>);</span><br><span class="line">				write(fd_fifo,<span class="string">&quot;volume -10\n&quot;</span>,<span class="built_in">strlen</span>(<span class="string">&quot;volume -10\n&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">615</span> &amp;&amp; ts.x&lt;<span class="number">668</span>)  <span class="comment">//升音量</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;volume+10.........................\n&quot;</span>);</span><br><span class="line">				write(fd_fifo,<span class="string">&quot;volume 10\n&quot;</span>,<span class="built_in">strlen</span>(<span class="string">&quot;volume 10\n&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">253</span> &amp;&amp; ts.x&lt;<span class="number">330</span> || musicpreflag==<span class="number">1</span> )  <span class="comment">//上一首</span></span><br><span class="line">			&#123;</span><br><span class="line">				musicpreflag=<span class="number">0</span>;</span><br><span class="line">				system(<span class="string">&quot;killall -SIGKILL mplayer&quot;</span>);</span><br><span class="line">				sleep(<span class="number">1</span>);                             <span class="comment">//加延时确保关闭音乐</span></span><br><span class="line">				vflag--;</span><br><span class="line">				<span class="keyword">if</span> (vflag &lt; <span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					vflag=<span class="number">0</span>;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;First music!.........................\n&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				system(strCat1[vflag]);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">447</span> &amp;&amp; ts.x&lt;<span class="number">526</span>|| musicnextflag==<span class="number">1</span>) <span class="comment">//下一首</span></span><br><span class="line">			&#123;</span><br><span class="line">				musicnextflag=<span class="number">0</span>;</span><br><span class="line">				system(<span class="string">&quot;killall -SIGKILL mplayer&quot;</span>);</span><br><span class="line">				sleep(<span class="number">1</span>);   </span><br><span class="line">				vflag++;</span><br><span class="line">				<span class="keyword">if</span> (vflag &gt; <span class="number">3</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					vflag =<span class="number">3</span> ;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;Last video!.........................\n&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				system(strCat1[vflag]);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">700</span> &amp;&amp; ts.x&lt;<span class="number">800</span> &amp;&amp; ts.y&gt;<span class="number">380</span> &amp;&amp; ts.y&lt;<span class="number">480</span> || mode == MAIN )  <span class="comment">//返回</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;back!\n&quot;</span>);</span><br><span class="line">				system(<span class="string">&quot;killall -SIGKILL mplayer&quot;</span>);</span><br><span class="line">				mode=MAIN;</span><br><span class="line">				lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">				<span class="comment">// system(&quot;clear&quot;);</span></span><br><span class="line">				sleep(<span class="number">1</span>);  </span><br><span class="line">				flag2 = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>music.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MUSIC_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MUSIC_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dir.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;touch.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">musicplay</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> mode;</span><br><span class="line"><span class="comment">//下面的extern char均可改为char，在.c文件删去初始化即可，本人图方便就随便写了</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> musicpreflag;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> musicnextflag;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> musicspflag;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>photo.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;photo.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> strCat[<span class="number">15</span>][<span class="number">30</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">photo_thread</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">	num=<span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> a[]=&#123;<span class="string">&quot;pic/&quot;</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">sprintf</span>(strCat[i],<span class="string">&quot;%s%s&quot;</span>,a,file_name[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		num++;</span><br><span class="line">		<span class="keyword">if</span> (file_name[i][<span class="number">0</span>]==<span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			num--;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;last num=%d\n&quot;</span>,num);</span><br><span class="line">			num--;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;numflag=%d\n&quot;</span>,num);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (mode == PHOTO)</span><br><span class="line">	&#123;</span><br><span class="line">		lcd_show_bmp(strCat[pic_flag]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">photoshow</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	gs=<span class="number">0</span>;</span><br><span class="line">	IIC_gs=<span class="number">0</span>;</span><br><span class="line">	loopflag = <span class="number">0</span>;</span><br><span class="line">	<span class="type">pthread_t</span> tid_ts;</span><br><span class="line">	<span class="type">int</span> ret;</span><br><span class="line">	ret = pthread_create(&amp;tid_ts, <span class="literal">NULL</span>, photo_thread, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span>(ret &lt; <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;create ts_thread error&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="number">650</span> &lt; ts.x &amp;&amp; ts.x &lt; <span class="number">800</span> &amp;&amp; <span class="number">0</span> &lt; ts.y &amp;&amp; ts.y &lt; <span class="number">100</span> || loopflag)<span class="comment">//循环</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;loop on!\n&quot;</span>);</span><br><span class="line">			loopflag = <span class="number">0</span>;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				pic_flag++;</span><br><span class="line">				sleep(<span class="number">1</span>);</span><br><span class="line">				<span class="keyword">if</span>(pic_flag == num)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="comment">//printf(&quot;loop!\n&quot;);</span></span><br><span class="line">					pic_flag=<span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(<span class="number">650</span>&lt;ts.x &amp;&amp; ts.x&lt;<span class="number">800</span> &amp;&amp; <span class="number">150</span>&lt;ts.y &amp;&amp; ts.y&lt;<span class="number">300</span> || loopflag )</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;loop out!\n&quot;</span>);</span><br><span class="line">					loopflag = <span class="number">0</span>;</span><br><span class="line">					ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="number">650</span>&lt;ts.x &amp;&amp; ts.x&lt;<span class="number">800</span> &amp;&amp; <span class="number">0</span>&lt;ts.y &amp;&amp; ts.y&lt;<span class="number">100</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			pic_flag++;</span><br><span class="line">			<span class="keyword">if</span>(pic_flag &gt; num)</span><br><span class="line">			&#123;</span><br><span class="line">				pic_flag = num;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;Last picture!\n&quot;</span>);</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;Next picture\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="number">0</span>&lt;ts.x &amp;&amp; ts.x&lt;<span class="number">150</span> &amp;&amp; <span class="number">0</span>&lt;ts.y &amp;&amp; ts.y&lt;<span class="number">100</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			pic_flag--;</span><br><span class="line">			<span class="keyword">if</span>(pic_flag &lt; <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;First picture!\n&quot;</span>);</span><br><span class="line">				pic_flag=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;Prev picture\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(delflag &amp;&amp; num!=<span class="number">1</span>)</span><br><span class="line">		&#123; </span><br><span class="line">			delflag = <span class="number">0</span>;</span><br><span class="line">			num--;</span><br><span class="line">			<span class="type">char</span> a[]=&#123;<span class="string">&quot;pic/&quot;</span>&#125;;</span><br><span class="line">			<span class="type">char</span> newfile_name[<span class="number">15</span>][<span class="number">30</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;num+<span class="number">1</span>; ++i)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (i &lt; pic_flag)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">strcpy</span>(newfile_name[i],file_name[i]);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">strcpy</span>(newfile_name[i],file_name[i+<span class="number">1</span>]);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">15</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">sprintf</span>(strCat[i],<span class="string">&quot;%s%s&quot;</span>,a,newfile_name[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">15</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;strCat[%d] = %s\n&quot;</span>,i,strCat[i]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (addflag)</span><br><span class="line">		&#123;  </span><br><span class="line">			addflag = <span class="number">0</span>;</span><br><span class="line">			<span class="type">char</span> buf[<span class="number">1</span>][<span class="number">6</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Please write the name of the picture\n&quot;</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;data:&quot;</span>);</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,buf[<span class="number">1</span>]);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;buf=%s\n&quot;</span>,buf[<span class="number">1</span>]);</span><br><span class="line">			num++;</span><br><span class="line">			<span class="type">char</span> a[]=&#123;<span class="string">&quot;pic/&quot;</span>&#125;;</span><br><span class="line">			<span class="type">char</span> newfile_name[<span class="number">15</span>][<span class="number">30</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;num+<span class="number">1</span>; ++i)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (i &lt; pic_flag)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">strcpy</span>(newfile_name[i],file_name[i]);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (i == pic_flag)</span><br><span class="line">				&#123;   </span><br><span class="line">					<span class="built_in">strcpy</span>(newfile_name[i],buf[<span class="number">1</span>]);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">strcpy</span>(newfile_name[i],file_name[i<span class="number">-1</span>]);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">sprintf</span>(strCat[i],<span class="string">&quot;%s%s&quot;</span>,a,newfile_name[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;<span class="number">15</span>;i++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;strCat[%d] = %s\n&quot;</span>,i,strCat[i]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (ts.x &gt; <span class="number">700</span> &amp;&amp; ts.x &lt; <span class="number">800</span> &amp;&amp; ts.y &gt; <span class="number">420</span> &amp;&amp; ts.y &lt; <span class="number">480</span> ||  mode == MAIN)</span><br><span class="line">		&#123;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			pthread_cancel(tid_ts);</span><br><span class="line">			<span class="comment">//退出电子相册</span></span><br><span class="line">			mode=MAIN;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>photo.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __PHOTO_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __PHOTO_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dir.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;touch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gesture.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIC 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UI 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VIDEO 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MUSIC 3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAIN 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PHOTO 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CAMERA 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HUMITURE 5</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">photoshow</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">photo_thread</span><span class="params">(<span class="type">void</span> *arg)</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> <span class="title">xy</span> <span class="title">ts</span>;</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> mode;</span><br><span class="line"><span class="type">int</span> loopflag;</span><br><span class="line"><span class="type">int</span> addflag;</span><br><span class="line"><span class="type">int</span> delflag;</span><br><span class="line"><span class="type">int</span> num;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>touch.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;touch.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> mode=MAIN;</span><br><span class="line"><span class="type">int</span> pic_flag=<span class="number">0</span>;</span><br><span class="line"><span class="type">pthread_t</span> tid_gxy;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xy</span> <span class="title">ts</span>;</span></span><br><span class="line"><span class="type">int</span> x,y;</span><br><span class="line"><span class="type">int</span> s_x = <span class="number">0</span> ;</span><br><span class="line"><span class="type">int</span> s_y = <span class="number">0</span> ;</span><br><span class="line"><span class="type">int</span> e_x = <span class="number">0</span> ;</span><br><span class="line"><span class="type">int</span> e_y = <span class="number">0</span> ;</span><br><span class="line"><span class="type">int</span> gs=<span class="number">0</span>;<span class="comment">//滑动标志位</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">gesture_status_catch</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		gs = Slide_Pos();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">get_gs_pthread_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">pthread_t</span> tid_gs;</span><br><span class="line">	<span class="type">int</span> gs_ret;</span><br><span class="line">	gs_ret = pthread_create(&amp;tid_gs, <span class="literal">NULL</span>,gesture_status_catch, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span>(gs_ret &lt; <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;create thread gesture_status_catch error&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tid_gs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">get_xy</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		ts=ts_get_xy();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">get_xy_pthread_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> get_xy_ret;</span><br><span class="line">	get_xy_ret = pthread_create(&amp;tid_gxy, <span class="literal">NULL</span>,get_xy, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span>(get_xy_ret &lt; <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;create thread get_xy error&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;create thread get_xy ok!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_xy_pthread_uninit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	pthread_cancel(tid_gxy);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">Slide_Pos</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> fd_ts;</span><br><span class="line">	fd_ts = open(<span class="string">&quot;/dev/input/event0&quot;</span>, O_RDONLY);</span><br><span class="line">	<span class="keyword">if</span>(fd_ts == <span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;open ts&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">input_event</span> <span class="title">ts_data</span>;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//2、读取触摸屏的数据</span></span><br><span class="line">		read(fd_ts, &amp;ts_data, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> input_event));</span><br><span class="line">		<span class="keyword">if</span>(ts_data.type == EV_ABS)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(ts_data.code == ABS_X)</span><br><span class="line">				x = ts_data.value*<span class="number">800</span>/<span class="number">1024</span>;<span class="comment">//驱动芯片是否是1024*600的规格，是的话就得换算</span></span><br><span class="line">			<span class="keyword">if</span>(ts_data.code == ABS_Y)</span><br><span class="line">				y = ts_data.value*<span class="number">480</span>/<span class="number">600</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (ts_data.type == EV_KEY &amp;&amp; ts_data.code == BTN_TOUCH &amp;&amp; ts_data.value == <span class="number">1</span> )</span><br><span class="line">		&#123;</span><br><span class="line">			s_x = x ;</span><br><span class="line">			s_y = y ;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;finger down:(%d,%d)--\n&quot;</span> , x , y);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 判断是否为松手  结束了</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> ( ts_data.code == BTN_TOUCH &amp;&amp; ts_data.value == <span class="number">0</span> )</span><br><span class="line">		&#123;</span><br><span class="line">			e_x = x ;</span><br><span class="line">			e_y = y ;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;finger up:(%d,%d)--\n&quot;</span> , x , y);</span><br><span class="line">			<span class="type">int</span> DifferenceX = s_x - e_x ;<span class="comment">//横向滑动差值</span></span><br><span class="line">			<span class="type">int</span> DifferenceY = s_y - e_y ;<span class="comment">//纵向滑动差值</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Difference:(%d,%d)--\n&quot;</span> , DifferenceX , DifferenceY);</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">abs</span>(DifferenceX) &gt; <span class="built_in">abs</span>(DifferenceY))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>( DifferenceX &gt; <span class="number">10</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="comment">/* 从右往左移动 */</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;left\n&quot;</span>);</span><br><span class="line">					<span class="keyword">return</span> Left;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>( DifferenceX &lt; <span class="number">-10</span>)				</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="comment">/* 从左往右移动 */</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;right\n&quot;</span>);</span><br><span class="line">					<span class="keyword">return</span> Right;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(DifferenceY &gt; <span class="number">10</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="comment">/* 从下往上移动 */</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;up\n&quot;</span>);</span><br><span class="line">					<span class="keyword">return</span> Up;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(DifferenceY &lt; <span class="number">-10</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="comment">/* 从上往下移动 */</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;down\n&quot;</span>);</span><br><span class="line">					<span class="keyword">return</span> Down;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	close(fd_ts);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> xy <span class="title function_">ts_get_xy</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">xy</span> <span class="title">z</span>;</span></span><br><span class="line">	<span class="type">int</span> x,y;</span><br><span class="line">	<span class="type">int</span> fd_ts;</span><br><span class="line">	fd_ts = open(<span class="string">&quot;/dev/input/event0&quot;</span>, O_RDONLY);</span><br><span class="line">	<span class="keyword">if</span>(fd_ts == <span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;open ts&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">input_event</span> <span class="title">ts_data</span>;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//2、读取触摸屏的数据</span></span><br><span class="line">		read(fd_ts, &amp;ts_data, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> input_event));</span><br><span class="line">		<span class="keyword">if</span>(ts_data.type == EV_ABS)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(ts_data.code == ABS_X)</span><br><span class="line">				x = ts_data.value*<span class="number">800</span>/<span class="number">1024</span>;<span class="comment">//驱动芯片是否是1024*600的规格，是的话就得换算</span></span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(ts_data.code == ABS_Y)</span><br><span class="line">				y = ts_data.value*<span class="number">480</span>/<span class="number">600</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	z.x=x;</span><br><span class="line">	z.y=y;</span><br><span class="line"></span><br><span class="line">	close(fd_ts);</span><br><span class="line">	<span class="keyword">return</span> z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>touch.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TOUCH_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TOUCH_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lcd.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Up 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Down 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Left 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Right 4</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIC 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UI 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VIDEO 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MUSIC 3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAIN 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PHOTO 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CAMERA 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HUMITURE 5</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xy</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">get_xy_pthread_init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">get_xy_pthread_uninit</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">get_gs_pthread_init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">get_gs_pthread_uninit</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> <span class="title">xy</span> <span class="title">ts</span>;</span></span><br><span class="line"><span class="keyword">struct</span> xy <span class="title function_">ts_get_xy</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> pic_flag,gs;</span><br><span class="line"><span class="type">int</span> <span class="title function_">Slide_Pos</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>udp.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;udp.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;arm_serial.h&quot;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">udp_init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//1、建立套接字（选择UDP协议 一定要选择这个 SOCK_DGRAM）</span></span><br><span class="line">	<span class="type">int</span> socketfd = socket(AF_INET,SOCK_DGRAM,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span>(socketfd == <span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;socketfd error\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//2、绑定自己的IP地址和端口号 ---这一步在客户端 可以省略</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">ownAddr</span>;</span><span class="comment">//定义一个IPV4结构体变量，初始化自己的信息</span></span><br><span class="line">	ownAddr.sin_family = AF_INET;<span class="comment">//IPV4</span></span><br><span class="line">	ownAddr.sin_port = htons(OWNPORT); <span class="comment">/*端口号*/</span></span><br><span class="line">	ownAddr.sin_addr.s_addr = inet_addr(OWNADDR);<span class="comment">//本地IP--&gt;网络IP</span></span><br><span class="line">	</span><br><span class="line">	bind(socketfd,(<span class="keyword">struct</span> sockaddr *)&amp;ownAddr,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in));</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//定义一个IPV4结构体变量，存储对方的IP地址和端口号</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">serverAddr</span>;</span></span><br><span class="line">	serverAddr.sin_family = AF_INET;<span class="comment">//IPV4</span></span><br><span class="line">	serverAddr.sin_port = htons(SERVERPORT); <span class="comment">/*端口号*/</span></span><br><span class="line">	serverAddr.sin_addr.s_addr = inet_addr(SERVERADDR);<span class="comment">//本地IP--&gt;网络IP</span></span><br><span class="line">		<span class="comment">// char *buf1;</span></span><br><span class="line">		<span class="comment">// int bmp_fd=open(&quot;pic/car.bmp&quot;,O_RDWR);</span></span><br><span class="line">		<span class="comment">// if(bmp_fd==-1)</span></span><br><span class="line">		<span class="comment">// &#123;</span></span><br><span class="line">		<span class="comment">// 	perror(&quot;open bmp failed!\n&quot;);</span></span><br><span class="line">		<span class="comment">// 	return -1;</span></span><br><span class="line">		<span class="comment">// &#125;</span></span><br><span class="line">		<span class="comment">//将读写位置移到文件尾</span></span><br><span class="line">		<span class="comment">//int bmp_size=lseek(bmp_fd,0,SEEK_END);</span></span><br><span class="line">		<span class="comment">//printf(&quot;bmp_size is:%d\n&quot;,bmp_size);</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//为bmp_size申请堆空间</span></span><br><span class="line">		<span class="comment">//buf1=malloc(bmp_size);</span></span><br><span class="line">		<span class="comment">//将文件指针偏移到开头</span></span><br><span class="line">		<span class="comment">//lseek(bmp_fd,0,SEEK_SET);</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//将图片大小读出，放在buf中</span></span><br><span class="line">		<span class="comment">//read(bmp_fd,buf1,bmp_size);</span></span><br><span class="line">		<span class="comment">//3、直接发送（聊天）</span></span><br><span class="line">	<span class="keyword">while</span>(mode == UDP)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">char</span> buf[<span class="number">1024</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">		<span class="keyword">if</span> (ts.y&gt;<span class="number">300</span> &amp;&amp; ts.y&lt;<span class="number">480</span> &amp;&amp; ts.x&gt;<span class="number">370</span> &amp;&amp; ts.x&lt;<span class="number">450</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			ts.y=<span class="number">0</span>;ts.x=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;data:&quot;</span>);</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,buf);</span><br><span class="line">			sendto(socketfd,buf,<span class="built_in">strlen</span>(buf),<span class="number">0</span>,(<span class="keyword">struct</span> sockaddr *)&amp;serverAddr,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//sendto(socketfd,buf1,strlen(buf1),0,(struct sockaddr *)&amp;serverAddr,sizeof(struct sockaddr_in));</span></span><br><span class="line">		<span class="keyword">if</span>(ts.y&gt;<span class="number">380</span> &amp;&amp; ts.y&lt;<span class="number">480</span> &amp;&amp; ts.x&gt;<span class="number">700</span> &amp;&amp; ts.x&lt;<span class="number">800</span> || mode == MAIN )  <span class="comment">//返回</span></span><br><span class="line">		&#123;</span><br><span class="line">			ts.y=<span class="number">0</span>;ts.x=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;back!\n&quot;</span>);</span><br><span class="line">			mode=MAIN;</span><br><span class="line">			lcd_show_bmp(<span class="string">&quot;ui/main.bmp&quot;</span>);</span><br><span class="line">			<span class="comment">// system(&quot;clear&quot;);</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//4、关闭 </span></span><br><span class="line">	close(socketfd);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>udp.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __UDP_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __UDP_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span>          <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span> <span class="comment">// for open</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span> <span class="comment">// for close</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;touch.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  OWNADDR  <span class="string">&quot;10.12.94.196&quot;</span>  <span class="comment">//我自己ubuntu的ip地址</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  OWNPORT  20000 <span class="comment">//我自己ubuntu的该程序的端口号</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  SERVERADDR <span class="string">&quot;10.12.94.159&quot;</span><span class="comment">//服务器的IP地址 也就是  对方的 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  SERVERPORT  10000  <span class="comment">//服务器的端口号  也就是  对方的 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UDP 4</span></span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> <span class="title">xy</span> <span class="title">ts</span>;</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> mode;</span><br><span class="line"><span class="type">int</span> <span class="title function_">udp_init</span><span class="params">()</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>video.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;video.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> videopreflag=<span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> videonextflag=<span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> videospflag; <span class="comment">//暂停播放接口flag</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">init_mplayer</span><span class="params">()</span><span class="comment">//创建一个管道文件并且打开它，返回管道文件的文件描述符</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//创建一个管道文件</span></span><br><span class="line">	<span class="type">int</span> ret = mkfifo(<span class="string">&quot;/tmp/myfifo&quot;</span>, <span class="number">0777</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="number">-1</span> == ret)</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;mkfifo failed&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> fd = open(<span class="string">&quot;/tmp/myfifo&quot;</span>, O_RDWR);</span><br><span class="line">	<span class="keyword">if</span>(<span class="number">-1</span> == fd)</span><br><span class="line">	&#123;</span><br><span class="line">		perror(<span class="string">&quot;open fifo failed&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> fd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">video_ts_show</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> fd_fifo = init_mplayer();</span><br><span class="line">	<span class="type">char</span> a[]=&#123;<span class="string">&quot;mplayer -slave -quiet -input file=/tmp/myfifo -zoom -x 800 -y 420  video/&quot;</span>&#125;;</span><br><span class="line">	<span class="type">char</span> b[]=&#123;<span class="string">&quot; &amp;&quot;</span>&#125;;</span><br><span class="line">	<span class="type">char</span> strCat1[<span class="number">15</span>][<span class="number">100</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">sprintf</span>(strCat1[i],<span class="string">&quot;%s%s%s&quot;</span>,a,file_name[i],b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;--------------------------------%d-----------------------\n&quot;</span>, __LINE__);</span><br><span class="line">	videospflag=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> spflag = <span class="number">0</span>;        <span class="comment">//暂停播放标志位</span></span><br><span class="line">	<span class="type">int</span> playingflag = <span class="number">0</span>;    </span><br><span class="line">	<span class="type">int</span> muteflag = <span class="number">0</span>;      <span class="comment">//静音标志位</span></span><br><span class="line">	<span class="type">int</span> vflag = <span class="number">0</span>;         <span class="comment">//视频数字标志位</span></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(ts.x&gt;<span class="number">260</span> &amp;&amp; ts.x&lt;<span class="number">500</span> &amp;&amp; ts.y&gt;<span class="number">108</span> &amp;&amp; ts.y&lt;<span class="number">320</span> || videospflag == <span class="number">2</span>)   <span class="comment">//上边播放视频</span></span><br><span class="line">		&#123;		</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">			videospflag = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span> (playingflag == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				playingflag++;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;play!\n&quot;</span>);</span><br><span class="line">				system(strCat1[vflag]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (mode == MAIN)</span><br><span class="line">			&#123;</span><br><span class="line">				playingflag=<span class="number">0</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(ts.y&gt;<span class="number">380</span> &amp;&amp; ts.y&lt;<span class="number">480</span> || mode == MAIN || videonextflag==<span class="number">1</span> || videopreflag==<span class="number">1</span> || videospflag == <span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">100</span> &amp;&amp; ts.x&lt;<span class="number">184</span>) <span class="comment">//后退</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;back 10s......................\n&quot;</span>);</span><br><span class="line">				write(fd_fifo,<span class="string">&quot;seek -10\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;seek -10\n&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">184</span> &amp;&amp; ts.x&lt;<span class="number">285</span> || videospflag == <span class="number">1</span>)  <span class="comment">//暂停/播放</span></span><br><span class="line">			&#123;</span><br><span class="line">				videospflag = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">if</span>(spflag == <span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;pause.................\n&quot;</span>);</span><br><span class="line">					<span class="comment">// write(fd_fifo,&quot;pause\n&quot;,strlen(&quot;pause\n&quot;));</span></span><br><span class="line">					system(<span class="string">&quot;killall -19 mplayer&quot;</span>);</span><br><span class="line">					spflag = <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(spflag == <span class="number">1</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;continue.................\n&quot;</span>);</span><br><span class="line">					system(<span class="string">&quot;killall -18 mplayer&quot;</span>);</span><br><span class="line">					<span class="comment">// write(fd_fifo,&quot;pause\n&quot;,strlen(&quot;pause\n&quot;));</span></span><br><span class="line">					spflag = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">285</span> &amp;&amp; ts.x&lt;<span class="number">338</span>) <span class="comment">//快进/</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;go 10s.........................\n&quot;</span>);</span><br><span class="line">				write(fd_fifo,<span class="string">&quot;seek 10\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;seek 10\n&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">338</span> &amp;&amp; ts.x&lt;<span class="number">403</span>)  <span class="comment">//降音量</span></span><br><span class="line">			&#123;	<span class="built_in">printf</span>(<span class="string">&quot;volume-10.........................\n&quot;</span>);</span><br><span class="line">				write(fd_fifo,<span class="string">&quot;volume -10\n&quot;</span>,<span class="built_in">strlen</span>(<span class="string">&quot;volume -10\n&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">403</span> &amp;&amp; ts.x&lt;<span class="number">480</span>)  <span class="comment">//升音量</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;volume+10.........................\n&quot;</span>);</span><br><span class="line">				write(fd_fifo,<span class="string">&quot;volume 10\n&quot;</span>,<span class="built_in">strlen</span>(<span class="string">&quot;volume 10\n&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">480</span> &amp;&amp; ts.x&lt;<span class="number">560</span>)  <span class="comment">//静音/非静音</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(muteflag ==<span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;volume off.........................\n&quot;</span>);</span><br><span class="line">					write(fd_fifo,<span class="string">&quot;mute 1\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;mute 1\n&quot;</span>));</span><br><span class="line">					muteflag = <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(muteflag == <span class="number">1</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;volume on.........................\n&quot;</span>);</span><br><span class="line">					write(fd_fifo,<span class="string">&quot;mute 0\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;mute 0\n&quot;</span>));</span><br><span class="line">					muteflag = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">554</span> &amp;&amp; ts.x&lt;<span class="number">626</span> || videopreflag==<span class="number">1</span> )  <span class="comment">//上一个</span></span><br><span class="line">			&#123;</span><br><span class="line">				videopreflag=<span class="number">0</span>;</span><br><span class="line">				system(<span class="string">&quot;killall -9 mplayer&quot;</span>);</span><br><span class="line">				vflag--;</span><br><span class="line">				<span class="keyword">if</span> (vflag &lt; <span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					vflag=<span class="number">0</span>;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;First video!.........................\n&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				system(strCat1[vflag]);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">626</span> &amp;&amp; ts.x&lt;<span class="number">700</span> || videonextflag==<span class="number">1</span> )  <span class="comment">//下一个</span></span><br><span class="line">			&#123;</span><br><span class="line">				videonextflag=<span class="number">0</span>;</span><br><span class="line">				system(<span class="string">&quot;killall -9 mplayer&quot;</span>);</span><br><span class="line">				vflag++;</span><br><span class="line">				<span class="keyword">if</span> (vflag &gt; <span class="number">2</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					vflag=<span class="number">2</span>;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;Last video!.........................\n&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				system(strCat1[vflag]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(ts.x&gt;<span class="number">700</span> &amp;&amp; ts.x&lt;<span class="number">800</span> || mode == MAIN)  <span class="comment">//返回</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;back!\n&quot;</span>);</span><br><span class="line">				write(fd_fifo,<span class="string">&quot;quit\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;quit\n&quot;</span>));</span><br><span class="line">				system(<span class="string">&quot;killall -9 mplayer&quot;</span>);</span><br><span class="line">				<span class="comment">// system(&quot;clear&quot;);</span></span><br><span class="line">				playingflag=<span class="number">0</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			ts.x=<span class="number">0</span>;ts.y=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>video.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __VIDEO_h__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __VIDEO_h__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dir.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;touch.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> <span class="title">xy</span> <span class="title">ts</span>;</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">video_ts_show</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">char</span> videospflag;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> mode; </span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> videopreflag;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> videonextflag;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Makefile文件(<em>基本是通用万能的语句，但不推荐长期使用</em>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">all:</span><br><span class="line">	arm-linux-gcc  *.c  -o main  -I ./ -L ./ -l font  -lpthread -lm </span><br><span class="line">clean:</span><br><span class="line">	<span class="built_in">rm</span> *.o main</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://192.168.0.9:80">JAS-guanjieshi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://192.168.0.9/posts/10007/">http://192.168.0.9/posts/10007/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://192.168.0.9:80" target="_blank">JAS's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/IIC%E9%80%9A%E4%BF%A1/">IIC通信</a><a class="post-meta__tags" href="/tags/%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1/">串口通信</a><a class="post-meta__tags" href="/tags/UDP%E9%80%9A%E4%BF%A1/">UDP通信</a><a class="post-meta__tags" href="/tags/ARM/">ARM</a><a class="post-meta__tags" href="/tags/PAJ7620U2/">PAJ7620U2</a><a class="post-meta__tags" href="/tags/GEC6818/">GEC6818</a><a class="post-meta__tags" href="/tags/DHT11/">DHT11</a><a class="post-meta__tags" href="/tags/zigbee/">zigbee</a></div><div class="post_share"><div class="social-share" data-image="/img/68182.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/10008/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/qt7.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">基于qt的网络视频监控系统（附程序）</div></div></a></div><div class="next-post pull-right"><a href="/posts/10006/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/6818.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">基于粤嵌GEC6818开发板的智能家居控制系统（附程序）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/10006/" title="基于粤嵌GEC6818开发板的智能家居控制系统（附程序）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/6818.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-21</div><div class="title">基于粤嵌GEC6818开发板的智能家居控制系统（附程序）</div></div></a></div><div><a href="/posts/10008/" title="基于qt的网络视频监控系统（附程序）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/qt7.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-23</div><div class="title">基于qt的网络视频监控系统（附程序）</div></div></a></div><div><a href="/posts/10002/" title="稚晖君Quark-n使用笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/quark1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-19</div><div class="title">稚晖君Quark-n使用笔记</div></div></a></div><div><a href="/posts/10009/" title="Upcycling-智能家庭陪伴机器人-"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/robotzmt.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-08</div><div class="title">Upcycling-智能家庭陪伴机器人-</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">JAS-guanjieshi</div><div class="author-info__description">  不只是会写业务代码的  嵌入式攻城狮！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">49</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ScientificArt" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1175595406@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本博客仅作为个人项目、个人笔记展示平台，无商业用途！如有侵权请联系本人：        QQ:1175595406       VX:a117559540642</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">一、需求分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.</span> <span class="toc-text">二、功能设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%E5%8F%8A%E5%88%86%E6%9E%90%EF%BC%88%E5%9B%BE%E7%89%87%E5%A4%9A%E4%B8%BAgif%E5%9B%BE%EF%BC%8C%E5%8A%A0%E8%BD%BD%E5%8F%AF%E8%83%BD%E4%BC%9A%E7%BC%93%E6%85%A2%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">三、运行结果及分析（图片多为gif图，加载可能会缓慢）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E5%BD%95%EF%BC%9A%E9%A1%B9%E7%9B%AE%E6%A0%B8%E5%BF%83%E6%BA%90%E7%A8%8B%E5%BA%8F"><span class="toc-number">4.</span> <span class="toc-text">附录：项目核心源程序</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/10019/" title="Sydney记录"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/newbing.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Sydney记录"/></a><div class="content"><a class="title" href="/posts/10019/" title="Sydney记录">Sydney记录</a><time datetime="2023-03-10T07:20:00.000Z" title="发表于 2023-03-10 15:20:00">2023-03-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/10009/" title="Upcycling-智能家庭陪伴机器人-"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/robotzmt.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Upcycling-智能家庭陪伴机器人-"/></a><div class="content"><a class="title" href="/posts/10009/" title="Upcycling-智能家庭陪伴机器人-">Upcycling-智能家庭陪伴机器人-</a><time datetime="2022-09-08T08:56:00.000Z" title="发表于 2022-09-08 16:56:00">2022-09-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/10010/" title="宿舍指纹锁（附程序）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zhiwenwaiguan.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="宿舍指纹锁（附程序）"/></a><div class="content"><a class="title" href="/posts/10010/" title="宿舍指纹锁（附程序）">宿舍指纹锁（附程序）</a><time datetime="2022-09-07T08:56:00.000Z" title="发表于 2022-09-07 16:56:00">2022-09-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/10008/" title="基于qt的网络视频监控系统（附程序）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/qt7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于qt的网络视频监控系统（附程序）"/></a><div class="content"><a class="title" href="/posts/10008/" title="基于qt的网络视频监控系统（附程序）">基于qt的网络视频监控系统（附程序）</a><time datetime="2022-07-23T03:50:00.000Z" title="发表于 2022-07-23 11:50:00">2022-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/10007/" title="手势识别智能家居控制系统项目（附程序）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/68182.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手势识别智能家居控制系统项目（附程序）"/></a><div class="content"><a class="title" href="/posts/10007/" title="手势识别智能家居控制系统项目（附程序）">手势识别智能家居控制系统项目（附程序）</a><time datetime="2022-07-21T13:20:00.000Z" title="发表于 2022-07-21 21:20:00">2022-07-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By JAS-guanjieshi</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'adKKmoloE9yGcoULXRRaFcVq-9Nh9j0Va',
      appKey: 'HwMHRaqs0JP6U91Ly00odivy',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":240,"height":220},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>